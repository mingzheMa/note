<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.53" />
    <meta name="theme" content="VuePress Theme Hope" />
    <title>setupï¼ˆç»„ä»¶åˆå§‹åŒ–ï¼‰ | marxçš„å­¦ä¹ ç¬”è®°</title><meta name="description" content="éƒ¨åˆ†å†…å®¹æ˜¯å‚è€ƒå¤–éƒ¨æ–‡ç« ï¼Œå±äºä¸ªäººå¤ä¹ ä½¿ç”¨">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style.31e87fe8.css" as="style" /><link rel="stylesheet" href="/assets/style.31e87fe8.css" />
    <link rel="modulepreload" href="/assets/app.9ac9284b.js"><link rel="modulepreload" href="/assets/3.setup.html.a49ffe9b.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/3.setup.html.6464d607.js"><link rel="prefetch" href="/assets/index.html.6c946c9f.js" as="script" /><link rel="prefetch" href="/assets/ES6å’ŒCommonJSæ¨¡å—åŒ–.html.993609d3.js" as="script" /><link rel="prefetch" href="/assets/index.html.c3b5ae80.js" as="script" /><link rel="prefetch" href="/assets/åŒ…è£…ç±»å‹.html.6ad5c91c.js" as="script" /><link rel="prefetch" href="/assets/æ‰‹å†™CommonJS.html.1498b864.js" as="script" /><link rel="prefetch" href="/assets/æ‰‹å†™Promise.html.a9d665da.js" as="script" /><link rel="prefetch" href="/assets/ç”Ÿæˆå™¨.html.30c11bf8.js" as="script" /><link rel="prefetch" href="/assets/ç±»å‹è½¬æ¢.html.101bf853.js" as="script" /><link rel="prefetch" href="/assets/è¿­ä»£å™¨.html.09e1ba62.js" as="script" /><link rel="prefetch" href="/assets/0.Reactä¸­çš„TSé›†æˆ.html.72297c73.js" as="script" /><link rel="prefetch" href="/assets/0.TSConfigé…ç½®.html.8e862c7f.js" as="script" /><link rel="prefetch" href="/assets/0.inferå…³é”®å­—.html.2de3f009.js" as="script" /><link rel="prefetch" href="/assets/0.å†…ç½®å·¥å…·.html.d0be95a8.js" as="script" /><link rel="prefetch" href="/assets/0.å‡½æ•°é‡è½½.html.472f247a.js" as="script" /><link rel="prefetch" href="/assets/0.æŠ½è±¡ç±».html.73a87988.js" as="script" /><link rel="prefetch" href="/assets/0.æ–­è¨€å‡½æ•°.html.7367871f.js" as="script" /><link rel="prefetch" href="/assets/0.æ¨¡æ¿å­—ç¬¦ä¸².html.ff0f7d9a.js" as="script" /><link rel="prefetch" href="/assets/0.æ¨¡æ¿å­—ç¬¦ä¸²å·¥å…·.html.37bd6f59.js" as="script" /><link rel="prefetch" href="/assets/0.ç±»å‹å±‚çº§.html.d19219c6.js" as="script" /><link rel="prefetch" href="/assets/0.ç±»çš„æ–¹æ³•è¦†ç›–.html.a293b1d6.js" as="script" /><link rel="prefetch" href="/assets/0.é™æ€ç±».html.8181c739.js" as="script" /><link rel="prefetch" href="/assets/100.å®ç°å¯¹æŸä¸ªå¯¹è±¡éƒ¨åˆ†å±æ€§è¿›è¡Œä¿®é¥°.html.c90c47fd.js" as="script" /><link rel="prefetch" href="/assets/101.å®ç°å¯¹è±¡å±æ€§äº’æ–¥ç±»å‹å·¥å…·.html.1c88a8bf.js" as="script" /><link rel="prefetch" href="/assets/102.å®ç°å¯¹è±¡ç±»å‹çš„äº¤å‰å¹¶è¡¥é›†.html.c34a2ab0.js" as="script" /><link rel="prefetch" href="/assets/103.å®ç°æå–æŸä¸ªå¯¹è±¡ä¸­å¿…é€‰å±æ€§.html.1b540263.js" as="script" /><link rel="prefetch" href="/assets/104.å®ç°Pickå’ŒOmitå‡½æ•°å¯¹å±æ€§å€¼æå–.html.5493e78d.js" as="script" /><link rel="prefetch" href="/assets/105.å®ç°å¯¹è±¡æ•°ç»„æ·±å±‚ä¿®é¥°.html.d35935ad.js" as="script" /><link rel="prefetch" href="/assets/index.html.cec00e38.js" as="script" /><link rel="prefetch" href="/assets/HOOK.html.d697ab33.js" as="script" /><link rel="prefetch" href="/assets/index.html.644c3b34.js" as="script" /><link rel="prefetch" href="/assets/Ref.html.82fe80d4.js" as="script" /><link rel="prefetch" href="/assets/æ¸²æŸ“åŸç†.html.0965e517.js" as="script" /><link rel="prefetch" href="/assets/1.æ ¸å¿ƒæ¦‚å¿µ.html.c41f806b.js" as="script" /><link rel="prefetch" href="/assets/2.ç®€å•ä½¿ç”¨.html.35b02576.js" as="script" /><link rel="prefetch" href="/assets/3.å®ç°ç®€æ˜“Redux.html.e69c76e0.js" as="script" /><link rel="prefetch" href="/assets/4.ä¸­é—´ä»¶.html.efc8b7e4.js" as="script" /><link rel="prefetch" href="/assets/index.html.0390cf8c.js" as="script" /><link rel="prefetch" href="/assets/1.install.html.ff2fa99b.js" as="script" /><link rel="prefetch" href="/assets/2.VueRouteræ„é€ å™¨.html.4daaa82a.js" as="script" /><link rel="prefetch" href="/assets/3.matcher.html.57e7a6fe.js" as="script" /><link rel="prefetch" href="/assets/index.html.f9ad7a4b.js" as="script" /><link rel="prefetch" href="/assets/index.html.c73209a9.js" as="script" /><link rel="prefetch" href="/assets/1.vnodeåˆ°dom.html.32d400a2.js" as="script" /><link rel="prefetch" href="/assets/2.diffæµç¨‹.html.3f7433e6.js" as="script" /><link rel="prefetch" href="/assets/4.å“åº”å¼.html.44b640e9.js" as="script" /><link rel="prefetch" href="/assets/index.html.b28797b1.js" as="script" /><link rel="prefetch" href="/assets/index.html.d4641eb2.js" as="script" /><link rel="prefetch" href="/assets/optimization.html.b1c39f99.js" as="script" /><link rel="prefetch" href="/assets/å¦‚ä½•å¤„ç†letä¸ºvar.html.347b2682.js" as="script" /><link rel="prefetch" href="/assets/æŒ‰éœ€å¼•å…¥.html.a1796dd7.js" as="script" /><link rel="prefetch" href="/assets/index.html.34f02707.js" as="script" /><link rel="prefetch" href="/assets/http1.0ã€1.1ã€2.0ã€3.0çš„åŒºåˆ«.html.6c1be5f5.js" as="script" /><link rel="prefetch" href="/assets/æ€§èƒ½ä¼˜åŒ–.html.e967da4a.js" as="script" /><link rel="prefetch" href="/assets/1.current.html.ee6a17a4.js" as="script" /><link rel="prefetch" href="/assets/2.confirmTransition.html.1e08f473.js" as="script" /><link rel="prefetch" href="/assets/3.è·¯ç”±å®ˆå«.html.893eaf6b.js" as="script" /><link rel="prefetch" href="/assets/4.url.html.9292353d.js" as="script" /><link rel="prefetch" href="/assets/5.å†…ç½®ç»„ä»¶.html.5418707b.js" as="script" /><link rel="prefetch" href="/assets/6.æ€»ç»“.html.63a80113.js" as="script" /><link rel="prefetch" href="/assets/index.html.24076b77.js" as="script" /><link rel="prefetch" href="/assets/1.ç›®å½•ç»“æ„.html.d9612b02.js" as="script" /><link rel="prefetch" href="/assets/2.æºç æ„å»º.html.e031a84b.js" as="script" /><link rel="prefetch" href="/assets/3.vueå…¥å£.html.e6400f8b.js" as="script" /><link rel="prefetch" href="/assets/1.ä»‹ç».html.15428a35.js" as="script" /><link rel="prefetch" href="/assets/2.new Vueå‘ç”Ÿäº†ä»€ä¹ˆ.html.d10d2c80.js" as="script" /><link rel="prefetch" href="/assets/3.Vue._mount.html.b0dd29c7.js" as="script" /><link rel="prefetch" href="/assets/4.Vue._render.html.3a23c2dc.js" as="script" /><link rel="prefetch" href="/assets/5.VNode.html.f0e0b1a7.js" as="script" /><link rel="prefetch" href="/assets/6.createElement.html.64c5eb72.js" as="script" /><link rel="prefetch" href="/assets/7.Vue._update.html.47465e04.js" as="script" /><link rel="prefetch" href="/assets/1.ä»‹ç».html.3a17ad55.js" as="script" /><link rel="prefetch" href="/assets/2.å“åº”å¼å¯¹è±¡.html.ea1d4db3.js" as="script" /><link rel="prefetch" href="/assets/3.ä¾èµ–æ”¶é›†.html.7b50dfa2.js" as="script" /><link rel="prefetch" href="/assets/4.æ´¾å‘æ›´æ–°.html.ae5d0c6a.js" as="script" /><link rel="prefetch" href="/assets/5._nexttick.html.7edd0ede.js" as="script" /><link rel="prefetch" href="/assets/6.æ£€æµ‹æ•°æ®å˜åŒ–.html.2155d52d.js" as="script" /><link rel="prefetch" href="/assets/7.è®¡ç®—å±æ€§å’Œç›‘å¬å±æ€§.html.5b224810.js" as="script" /><link rel="prefetch" href="/assets/1.ä»‹ç».html.a23cd9c1.js" as="script" /><link rel="prefetch" href="/assets/2.createComponent.html.57dccc1a.js" as="script" /><link rel="prefetch" href="/assets/3.patch.html.a97ff2e4.js" as="script" /><link rel="prefetch" href="/assets/1.keep-alive.html.36b34e0c.js" as="script" /><link rel="prefetch" href="/assets/404.html.c5de7dd9.js" as="script" /><link rel="prefetch" href="/assets/index.html.2c89d7a1.js" as="script" /><link rel="prefetch" href="/assets/ES6å’ŒCommonJSæ¨¡å—åŒ–.html.1b3df876.js" as="script" /><link rel="prefetch" href="/assets/index.html.6b68a311.js" as="script" /><link rel="prefetch" href="/assets/åŒ…è£…ç±»å‹.html.b6b457b7.js" as="script" /><link rel="prefetch" href="/assets/æ‰‹å†™CommonJS.html.69b5b2dc.js" as="script" /><link rel="prefetch" href="/assets/æ‰‹å†™Promise.html.9c97775a.js" as="script" /><link rel="prefetch" href="/assets/ç”Ÿæˆå™¨.html.2137c5bc.js" as="script" /><link rel="prefetch" href="/assets/ç±»å‹è½¬æ¢.html.ef4cb90c.js" as="script" /><link rel="prefetch" href="/assets/è¿­ä»£å™¨.html.e9946bad.js" as="script" /><link rel="prefetch" href="/assets/0.Reactä¸­çš„TSé›†æˆ.html.063517e8.js" as="script" /><link rel="prefetch" href="/assets/0.TSConfigé…ç½®.html.432b6aff.js" as="script" /><link rel="prefetch" href="/assets/0.inferå…³é”®å­—.html.a95448c5.js" as="script" /><link rel="prefetch" href="/assets/0.å†…ç½®å·¥å…·.html.f08316de.js" as="script" /><link rel="prefetch" href="/assets/0.å‡½æ•°é‡è½½.html.1102790d.js" as="script" /><link rel="prefetch" href="/assets/0.æŠ½è±¡ç±».html.727e4ade.js" as="script" /><link rel="prefetch" href="/assets/0.æ–­è¨€å‡½æ•°.html.c9c612bf.js" as="script" /><link rel="prefetch" href="/assets/0.æ¨¡æ¿å­—ç¬¦ä¸².html.75443447.js" as="script" /><link rel="prefetch" href="/assets/0.æ¨¡æ¿å­—ç¬¦ä¸²å·¥å…·.html.74aca23c.js" as="script" /><link rel="prefetch" href="/assets/0.ç±»å‹å±‚çº§.html.143c83c5.js" as="script" /><link rel="prefetch" href="/assets/0.ç±»çš„æ–¹æ³•è¦†ç›–.html.dfb1256b.js" as="script" /><link rel="prefetch" href="/assets/0.é™æ€ç±».html.43b26a81.js" as="script" /><link rel="prefetch" href="/assets/100.å®ç°å¯¹æŸä¸ªå¯¹è±¡éƒ¨åˆ†å±æ€§è¿›è¡Œä¿®é¥°.html.dd184ed8.js" as="script" /><link rel="prefetch" href="/assets/101.å®ç°å¯¹è±¡å±æ€§äº’æ–¥ç±»å‹å·¥å…·.html.c65e5683.js" as="script" /><link rel="prefetch" href="/assets/102.å®ç°å¯¹è±¡ç±»å‹çš„äº¤å‰å¹¶è¡¥é›†.html.63a5136a.js" as="script" /><link rel="prefetch" href="/assets/103.å®ç°æå–æŸä¸ªå¯¹è±¡ä¸­å¿…é€‰å±æ€§.html.256b6053.js" as="script" /><link rel="prefetch" href="/assets/104.å®ç°Pickå’ŒOmitå‡½æ•°å¯¹å±æ€§å€¼æå–.html.1a3a4d30.js" as="script" /><link rel="prefetch" href="/assets/105.å®ç°å¯¹è±¡æ•°ç»„æ·±å±‚ä¿®é¥°.html.5ef79a04.js" as="script" /><link rel="prefetch" href="/assets/index.html.0f50d2da.js" as="script" /><link rel="prefetch" href="/assets/HOOK.html.31093e5b.js" as="script" /><link rel="prefetch" href="/assets/index.html.92aa14b3.js" as="script" /><link rel="prefetch" href="/assets/Ref.html.dadb3e11.js" as="script" /><link rel="prefetch" href="/assets/æ¸²æŸ“åŸç†.html.40813145.js" as="script" /><link rel="prefetch" href="/assets/1.æ ¸å¿ƒæ¦‚å¿µ.html.9ca7e58d.js" as="script" /><link rel="prefetch" href="/assets/2.ç®€å•ä½¿ç”¨.html.be334732.js" as="script" /><link rel="prefetch" href="/assets/3.å®ç°ç®€æ˜“Redux.html.5404d971.js" as="script" /><link rel="prefetch" href="/assets/4.ä¸­é—´ä»¶.html.816326b4.js" as="script" /><link rel="prefetch" href="/assets/index.html.f15d1a10.js" as="script" /><link rel="prefetch" href="/assets/1.install.html.de1d4f22.js" as="script" /><link rel="prefetch" href="/assets/2.VueRouteræ„é€ å™¨.html.6eadb60e.js" as="script" /><link rel="prefetch" href="/assets/3.matcher.html.97a53819.js" as="script" /><link rel="prefetch" href="/assets/index.html.9d0836aa.js" as="script" /><link rel="prefetch" href="/assets/index.html.266b5a3f.js" as="script" /><link rel="prefetch" href="/assets/1.vnodeåˆ°dom.html.6d88c4c4.js" as="script" /><link rel="prefetch" href="/assets/2.diffæµç¨‹.html.f8d88d50.js" as="script" /><link rel="prefetch" href="/assets/4.å“åº”å¼.html.c4c70b9a.js" as="script" /><link rel="prefetch" href="/assets/index.html.e45ffebc.js" as="script" /><link rel="prefetch" href="/assets/index.html.22f74fb9.js" as="script" /><link rel="prefetch" href="/assets/optimization.html.bcaa7f29.js" as="script" /><link rel="prefetch" href="/assets/å¦‚ä½•å¤„ç†letä¸ºvar.html.98f4f3b5.js" as="script" /><link rel="prefetch" href="/assets/æŒ‰éœ€å¼•å…¥.html.e1489e28.js" as="script" /><link rel="prefetch" href="/assets/index.html.efd612a9.js" as="script" /><link rel="prefetch" href="/assets/http1.0ã€1.1ã€2.0ã€3.0çš„åŒºåˆ«.html.34b00bd1.js" as="script" /><link rel="prefetch" href="/assets/æ€§èƒ½ä¼˜åŒ–.html.5b363158.js" as="script" /><link rel="prefetch" href="/assets/1.current.html.615ba843.js" as="script" /><link rel="prefetch" href="/assets/2.confirmTransition.html.e0f18c0f.js" as="script" /><link rel="prefetch" href="/assets/3.è·¯ç”±å®ˆå«.html.fa35d094.js" as="script" /><link rel="prefetch" href="/assets/4.url.html.ad111fc7.js" as="script" /><link rel="prefetch" href="/assets/5.å†…ç½®ç»„ä»¶.html.7291d2d9.js" as="script" /><link rel="prefetch" href="/assets/6.æ€»ç»“.html.f79941f5.js" as="script" /><link rel="prefetch" href="/assets/index.html.1d444c5a.js" as="script" /><link rel="prefetch" href="/assets/1.ç›®å½•ç»“æ„.html.836b91c6.js" as="script" /><link rel="prefetch" href="/assets/2.æºç æ„å»º.html.e68b20be.js" as="script" /><link rel="prefetch" href="/assets/3.vueå…¥å£.html.3774a898.js" as="script" /><link rel="prefetch" href="/assets/1.ä»‹ç».html.2fc15692.js" as="script" /><link rel="prefetch" href="/assets/2.new Vueå‘ç”Ÿäº†ä»€ä¹ˆ.html.73024452.js" as="script" /><link rel="prefetch" href="/assets/3.Vue._mount.html.f356355e.js" as="script" /><link rel="prefetch" href="/assets/4.Vue._render.html.a490651f.js" as="script" /><link rel="prefetch" href="/assets/5.VNode.html.a85b0350.js" as="script" /><link rel="prefetch" href="/assets/6.createElement.html.847cdf2e.js" as="script" /><link rel="prefetch" href="/assets/7.Vue._update.html.f01baaf2.js" as="script" /><link rel="prefetch" href="/assets/1.ä»‹ç».html.b83f26c0.js" as="script" /><link rel="prefetch" href="/assets/2.å“åº”å¼å¯¹è±¡.html.7aaf5220.js" as="script" /><link rel="prefetch" href="/assets/3.ä¾èµ–æ”¶é›†.html.ed2bf5ca.js" as="script" /><link rel="prefetch" href="/assets/4.æ´¾å‘æ›´æ–°.html.3767f650.js" as="script" /><link rel="prefetch" href="/assets/5._nexttick.html.b3a0d6c2.js" as="script" /><link rel="prefetch" href="/assets/6.æ£€æµ‹æ•°æ®å˜åŒ–.html.45df22fa.js" as="script" /><link rel="prefetch" href="/assets/7.è®¡ç®—å±æ€§å’Œç›‘å¬å±æ€§.html.bfe7892e.js" as="script" /><link rel="prefetch" href="/assets/1.ä»‹ç».html.5c06c2a5.js" as="script" /><link rel="prefetch" href="/assets/2.createComponent.html.f5383b13.js" as="script" /><link rel="prefetch" href="/assets/3.patch.html.8b9599e6.js" as="script" /><link rel="prefetch" href="/assets/1.keep-alive.html.e64a9e8c.js" as="script" /><link rel="prefetch" href="/assets/404.html.c6c41902.js" as="script" /><link rel="prefetch" href="/assets/photoswipe.esm.720e8656.js" as="script" />
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><!----><!----><span class="site-name">marxçš„å­¦ä¹ ç¬”è®°</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/JS/" class="nav-link" aria-label="JS"><!---->JS<!----></a></div><div class="nav-item hide-in-mobile"><a href="/TS/" class="nav-link" aria-label="TS"><!---->TS<!----></a></div><div class="nav-item hide-in-mobile"><a href="/webpack/" class="nav-link" aria-label="webpack"><!---->webpack<!----></a></div><div class="nav-item hide-in-mobile"><a href="/react/" class="nav-link" aria-label="react"><!---->react<!----></a></div><div class="nav-item hide-in-mobile"><a href="/redux/" class="nav-link" aria-label="redux"><!---->redux<!----></a></div><div class="nav-item hide-in-mobile"><a href="/vue2%E6%BA%90%E7%A0%81/" class="nav-link" aria-label="vue2æºç "><!---->vue2æºç <!----></a></div><div class="nav-item hide-in-mobile"><a href="/vue3%E6%BA%90%E7%A0%81/" class="nav-link active" aria-label="vue3æºç "><!---->vue3æºç <!----></a></div><div class="nav-item hide-in-mobile"><a href="/vue-router3%E6%BA%90%E7%A0%81/" class="nav-link" aria-label="vue-router3æºç "><!---->vue-router3æºç <!----></a></div><div class="nav-item hide-in-mobile"><a href="/%E7%BD%91%E7%BB%9C/" class="nav-link" aria-label="ç½‘ç»œ"><!---->ç½‘ç»œ<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><!----><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/vue3%E6%BA%90%E7%A0%81/" class="nav-link sidebar-link sidebar-page" aria-label="é¦–é¡µ"><!---->é¦–é¡µ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue3%E6%BA%90%E7%A0%81/1.vnode%E5%88%B0dom.html" class="nav-link sidebar-link sidebar-page" aria-label="vnodeåˆ°domï¼ˆç»„ä»¶æ¸²æŸ“ï¼‰"><!---->vnodeåˆ°domï¼ˆç»„ä»¶æ¸²æŸ“ï¼‰<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/vue3%E6%BA%90%E7%A0%81/2.diff%E6%B5%81%E7%A8%8B.html" class="nav-link sidebar-link sidebar-page" aria-label="diffæµç¨‹ï¼ˆç»„ä»¶æ›´æ–°ï¼‰"><!---->diffæµç¨‹ï¼ˆç»„ä»¶æ›´æ–°ï¼‰<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="setupï¼ˆç»„ä»¶åˆå§‹åŒ–ï¼‰"><!---->setupï¼ˆç»„ä»¶åˆå§‹åŒ–ï¼‰<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html#åˆ›å»ºç»„ä»¶å®ä¾‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åˆ›å»ºç»„ä»¶å®ä¾‹"><!---->åˆ›å»ºç»„ä»¶å®ä¾‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html#è®¾ç½®ç»„ä»¶å®ä¾‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è®¾ç½®ç»„ä»¶å®ä¾‹"><!---->è®¾ç½®ç»„ä»¶å®ä¾‹<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html#åˆ›å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡ä»£ç†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åˆ›å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡ä»£ç†"><!---->åˆ›å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡ä»£ç†<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html#è°ƒç”¨setupå‡½æ•°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="è°ƒç”¨setupå‡½æ•°"><!---->è°ƒç”¨setupå‡½æ•°<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html#å¤„ç†setupå‡½æ•°è¿”å›ç»“æœ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¤„ç†setupå‡½æ•°è¿”å›ç»“æœ"><!---->å¤„ç†setupå‡½æ•°è¿”å›ç»“æœ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html#æ€»ç»“" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ€»ç»“"><!---->æ€»ç»“<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html#é™„åŠ " class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="é™„åŠ "><!---->é™„åŠ <!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html#runtime-onlyå’Œruntime-compiledç‰ˆæœ¬" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="runtime-onlyå’Œruntime-compiledç‰ˆæœ¬"><!---->runtime-onlyå’Œruntime-compiledç‰ˆæœ¬<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html#ä¸ºä»€ä¹ˆè°ƒç”¨setupéœ€è¦é€šè¿‡callwitherrorhandlingå‡½æ•°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¸ºä»€ä¹ˆè°ƒç”¨setupéœ€è¦é€šè¿‡callWithErrorHandlingå‡½æ•°"><!---->ä¸ºä»€ä¹ˆè°ƒç”¨setupéœ€è¦é€šè¿‡callWithErrorHandlingå‡½æ•°<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/vue3%E6%BA%90%E7%A0%81/4.%E5%93%8D%E5%BA%94%E5%BC%8F.html" class="nav-link sidebar-link sidebar-page" aria-label="å“åº”å¼"><!---->å“åº”å¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->setupï¼ˆç»„ä»¶åˆå§‹åŒ–ï¼‰</h1><div class="page-info"><!----><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-12-02T09:12:10.000Z"></span><!----><!----><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 12 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT12M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html#åˆ›å»ºç»„ä»¶å®ä¾‹" class="router-link-active router-link-exact-active toc-link level2">åˆ›å»ºç»„ä»¶å®ä¾‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html#è®¾ç½®ç»„ä»¶å®ä¾‹" class="router-link-active router-link-exact-active toc-link level2">è®¾ç½®ç»„ä»¶å®ä¾‹</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html#åˆ›å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡ä»£ç†" class="router-link-active router-link-exact-active toc-link level3">åˆ›å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡ä»£ç†</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html#è°ƒç”¨setupå‡½æ•°" class="router-link-active router-link-exact-active toc-link level3">è°ƒç”¨setupå‡½æ•°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html#å¤„ç†setupå‡½æ•°è¿”å›ç»“æœ" class="router-link-active router-link-exact-active toc-link level3">å¤„ç†setupå‡½æ•°è¿”å›ç»“æœ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html#æ€»ç»“" class="router-link-active router-link-exact-active toc-link level2">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html#é™„åŠ " class="router-link-active router-link-exact-active toc-link level2">é™„åŠ </a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html#runtime-onlyå’Œruntime-compiledç‰ˆæœ¬" class="router-link-active router-link-exact-active toc-link level3">runtime-onlyå’Œruntime-compiledç‰ˆæœ¬</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/vue3%E6%BA%90%E7%A0%81/3.setup.html#ä¸ºä»€ä¹ˆè°ƒç”¨setupéœ€è¦é€šè¿‡callwitherrorhandlingå‡½æ•°" class="router-link-active router-link-exact-active toc-link level3">ä¸ºä»€ä¹ˆè°ƒç”¨setupéœ€è¦é€šè¿‡callWithErrorHandlingå‡½æ•°</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="setup-ç»„ä»¶åˆå§‹åŒ–" tabindex="-1"><a class="header-anchor" href="#setup-ç»„ä»¶åˆå§‹åŒ–" aria-hidden="true">#</a> setupï¼ˆç»„ä»¶åˆå§‹åŒ–ï¼‰</h1><p>vue3æ–°å¢ <code>setup</code> é…ç½®ï¼Œæ˜¯Composition APIçš„å…¥å£</p><div class="language-vue line-numbers-mode" data-ext="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>num++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{num}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      num
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>jsçš„éƒ¨åˆ†ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™</p><div class="language-vue line-numbers-mode" data-ext="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>

<span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æˆ‘ä»¬æš‚æ—¶ä¸è€ƒè™‘è¿™ç§å†™æ³•ï¼Œä¸åˆ©äºæˆ‘ä»¬åˆ†ææºç </p></blockquote><p>åœ¨vue2.xç¼–å†™ç»„ä»¶çš„æ—¶å€™ï¼Œæ˜¯åœ¨åˆå§‹åŒ–é˜¶æ®µå°±å·²ç»å¯¹propsã€computedã€dataè¿›è¡Œæ•°æ®æ‹¦æˆªï¼Œå¹¶æ‰‹åŠ¨è§¦å‘è·å–æ•°æ®ä»è€Œæ”¶é›†ä¾èµ–ã€‚é‚£ä¹ˆåœ¨vue3ä¸­æ˜¯å¦‚ä½•è®¿é—®åˆ°setupå‡½æ•°çš„è¿”å›å€¼ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥é‡ç‚¹ç ”ç©¶</p><p>ä¸€ä¸ªç»„ä»¶çš„æ¸²æŸ“æµç¨‹æ˜¯</p><div class="language-txt line-numbers-mode" data-ext="txt"><pre class="language-txt"><code>åˆ›å»ºvnode =&gt; æ¸²æŸ“vnodeï¼ˆè½¬åŒ–æˆDomï¼‰ =&gt; æŒ‚è½½Dom
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åœ¨ç»„ä»¶æ¸²æŸ“vnodeä¹‹å‰è¿˜åšäº†ä¸€äº›å¤„ç†</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">const</span> mountComponent<span class="token operator">:</span> <span class="token function-variable function">MountComponentFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
    initialVNode<span class="token punctuation">,</span>
    container<span class="token punctuation">,</span>
    anchor<span class="token punctuation">,</span>
    parentComponent<span class="token punctuation">,</span>
    parentSuspense<span class="token punctuation">,</span>
    isSVG<span class="token punctuation">,</span>
    optimized
  <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> instance<span class="token operator">:</span> ComponentInternalInstance <span class="token operator">=</span>
      compatMountInstance <span class="token operator">||</span>
      <span class="token punctuation">(</span>initialVNode<span class="token punctuation">.</span>component <span class="token operator">=</span> <span class="token function">createComponentInstance</span><span class="token punctuation">(</span>
        initialVNode<span class="token punctuation">,</span>
        parentComponent<span class="token punctuation">,</span>
        parentSuspense
      <span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token function">setupComponent</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span>

    <span class="token function">setupRenderEffect</span><span class="token punctuation">(</span>
      instance<span class="token punctuation">,</span>
      initialVNode<span class="token punctuation">,</span>
      container<span class="token punctuation">,</span>
      anchor<span class="token punctuation">,</span>
      parentSuspense<span class="token punctuation">,</span>
      isSVG<span class="token punctuation">,</span>
      optimized
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚£å°±æ˜¯è¿›è¡Œäº†<strong>åˆ›å»ºç»„ä»¶å®ä¾‹</strong>ã€<strong>è®¾ç½®ç»„ä»¶å®ä¾‹</strong>ã€<strong>è®¾ç½®å¹¶è¿è¡Œå‰¯ä½œç”¨ï¼ˆæŒ‚è½½æ¸²æŸ“vnodeå‡½æ•°ï¼Œå¹¶è¿è¡Œï¼‰</strong></p><h2 id="åˆ›å»ºç»„ä»¶å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºç»„ä»¶å®ä¾‹" aria-hidden="true">#</a> åˆ›å»ºç»„ä»¶å®ä¾‹</h2><p>æˆ‘ä»¬å…ˆæ¥åˆ†æåˆ›å»ºç»„ä»¶å®ä¾‹ <code>createComponentInstance</code> å‡½æ•°</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createComponentInstance</span><span class="token punctuation">(</span>
  vnode<span class="token operator">:</span> VNode<span class="token punctuation">,</span>
  parent<span class="token operator">:</span> ComponentInternalInstance <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  suspense<span class="token operator">:</span> SuspenseBoundary <span class="token operator">|</span> <span class="token keyword">null</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> type <span class="token operator">=</span> vnode<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token class-name"><span class="token keyword">as</span></span> ConcreteComponent
  <span class="token comment">// inherit parent app context - or - if root, adopt from root vnode</span>
  <span class="token keyword">const</span> appContext <span class="token operator">=</span>
    <span class="token punctuation">(</span>parent <span class="token operator">?</span> parent<span class="token punctuation">.</span>appContext <span class="token operator">:</span> vnode<span class="token punctuation">.</span>appContext<span class="token punctuation">)</span> <span class="token operator">||</span> emptyAppContext

  <span class="token keyword">const</span> instance<span class="token operator">:</span> ComponentInternalInstance <span class="token operator">=</span> <span class="token punctuation">{</span>
    uid<span class="token operator">:</span> uid<span class="token operator">++</span><span class="token punctuation">,</span> <span class="token comment">// ç»„ä»¶id</span>
    vnode<span class="token punctuation">,</span> <span class="token comment">// ç»„ä»¶vnode</span>
    type<span class="token punctuation">,</span> <span class="token comment">// ç»„ä»¶ç±»å‹</span>
    parent<span class="token punctuation">,</span> <span class="token comment">// çˆ¶ç»„ä»¶å®ä¾‹</span>
    appContext<span class="token punctuation">,</span> <span class="token comment">// appä¸Šä¸‹æ–‡</span>
    root<span class="token operator">:</span> <span class="token keyword">null</span><span class="token operator">!</span><span class="token punctuation">,</span> <span class="token comment">// æ ¹ç»„ä»¶å®ä¾‹</span>
    next<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// æ–°ç»„ä»¶vnodeç”¨æ¥æ›´æ–°å¯¹æ¯”</span>
    subTree<span class="token operator">:</span> <span class="token keyword">null</span><span class="token operator">!</span><span class="token punctuation">,</span> <span class="token comment">// å­vnodeæ ‘</span>
    effect<span class="token operator">:</span> <span class="token keyword">null</span><span class="token operator">!</span><span class="token punctuation">,</span> <span class="token comment">// å“åº”å¼ç›¸å…³</span>
    update<span class="token operator">:</span> <span class="token keyword">null</span><span class="token operator">!</span><span class="token punctuation">,</span> <span class="token comment">// æ›´æ–°å‡½æ•°</span>
    scope<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">EffectScope</span><span class="token punctuation">(</span><span class="token boolean">true</span> <span class="token comment">/* detached */</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    render<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// æ¨¡æ¿æ¸²æŸ“å‡½æ•°</span>
    proxy<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// æ¸²æŸ“ä¸Šä¸‹æ–‡ä»£ç†</span>
    exposed<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    exposeProxy<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    withProxy<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// å¸¦æœ‰withåŒºå—çš„ä¸Šä¸‹æ–‡ä»£ç†</span>
    provides<span class="token operator">:</span> parent <span class="token operator">?</span> parent<span class="token punctuation">.</span>provides <span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>appContext<span class="token punctuation">.</span>provides<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// ç¥–è¾ˆç»„ä»¶ä¾èµ–æ³¨å…¥</span>
    accessCache<span class="token operator">:</span> <span class="token keyword">null</span><span class="token operator">!</span><span class="token punctuation">,</span> <span class="token comment">// æ¸²æŸ“ä»£ç†å±æ€§ç¼“å­˜</span>
    renderCache<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// æ¸²æŸ“ç¼“å­˜</span>

    <span class="token comment">// local resolved assets</span>
    components<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// è¯¥ç»„ä»¶ä¸Šæ³¨å†Œçš„ç»„ä»¶</span>
    directives<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// è¯¥ç»„ä»¶ä¸Šæ³¨å†Œçš„æŒ‡ä»¤</span>

    <span class="token comment">// resolved props and emits options</span>
    propsOptions<span class="token operator">:</span> <span class="token function">normalizePropsOptions</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> appContext<span class="token punctuation">)</span><span class="token punctuation">,</span>
    emitsOptions<span class="token operator">:</span> <span class="token function">normalizeEmitsOptions</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> appContext<span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// emit</span>
    emit<span class="token operator">:</span> <span class="token keyword">null</span><span class="token operator">!</span><span class="token punctuation">,</span> <span class="token comment">// è§¦å‘äº‹ä»¶æ–¹æ³•</span>
    emitted<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> 

    <span class="token comment">// props default value</span>
    propsDefaults<span class="token operator">:</span> <span class="token constant">EMPTY_OBJ</span><span class="token punctuation">,</span>

    <span class="token comment">// inheritAttrs</span>
    inheritAttrs<span class="token operator">:</span> type<span class="token punctuation">.</span>inheritAttrs<span class="token punctuation">,</span>

    <span class="token comment">// state</span>
    ctx<span class="token operator">:</span> <span class="token constant">EMPTY_OBJ</span><span class="token punctuation">,</span> <span class="token comment">// æ¸²æŸ“ä¸Šä¸‹æ–‡</span>
    data<span class="token operator">:</span> <span class="token constant">EMPTY_OBJ</span><span class="token punctuation">,</span> <span class="token comment">// data æ•°æ®</span>
    props<span class="token operator">:</span> <span class="token constant">EMPTY_OBJ</span><span class="token punctuation">,</span> <span class="token comment">// props æ•°æ®</span>
    attrs<span class="token operator">:</span> <span class="token constant">EMPTY_OBJ</span><span class="token punctuation">,</span> <span class="token comment">// æ™®é€šå±æ€§</span>
    slots<span class="token operator">:</span> <span class="token constant">EMPTY_OBJ</span><span class="token punctuation">,</span> <span class="token comment">// æ’æ§½</span>
    refs<span class="token operator">:</span> <span class="token constant">EMPTY_OBJ</span><span class="token punctuation">,</span> <span class="token comment">// ref</span>
    setupState<span class="token operator">:</span> <span class="token constant">EMPTY_OBJ</span><span class="token punctuation">,</span> <span class="token comment">// setupå‡½æ•°è¿”å›ç»“æœ</span>
    setupContext<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// setupå‡½æ•°ä¸Šä¸‹æ–‡</span>

    <span class="token comment">// suspense related suspenseç»„ä»¶ç›¸å…³</span>
    suspense<span class="token punctuation">,</span>
    suspenseId<span class="token operator">:</span> suspense <span class="token operator">?</span> suspense<span class="token punctuation">.</span>pendingId <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    asyncDep<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    asyncResolved<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

    <span class="token comment">// lifecycle hooks</span>
    <span class="token comment">// not using enums here because it results in computed properties</span>
    isMounted<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// æ˜¯å¦å·²æŒ‚è½½</span>
    isUnmounted<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// æ˜¯å¦å·²å¸è½½</span>
    isDeactivated<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// æ˜¯å¦å¤±æ´»</span>
    bc<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// beforCreateç”Ÿå‘½å‘¨æœŸ</span>
    c<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// createdç”Ÿå‘½å‘¨æœŸ</span>
    bm<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// beforeMountç”Ÿå‘½å‘¨æœŸ</span>
    m<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// mountedç”Ÿå‘½å‘¨æœŸ</span>
    bu<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// beforeUpdateç”Ÿå‘½å‘¨æœŸ</span>
    u<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// updatedç”Ÿå‘½å‘¨æœŸ</span>
    um<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// unmountedç”Ÿå‘½å‘¨æœŸ</span>
    bum<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// beforUnmountç”Ÿå‘½å‘¨æœŸ</span>
    da<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// deactivatedç”Ÿå‘½å‘¨æœŸ</span>
    a<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// activatedç”Ÿå‘½å‘¨æœŸ</span>
    rtg<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// renderTriggeredç”Ÿå‘½å‘¨æœŸï¼Œä»…å¼€å‘</span>
    rtc<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// renderTrackedç”Ÿå‘½å‘¨æœŸï¼Œä»…å¼€å‘</span>
    ec<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// errorCapturedç”Ÿå‘½å‘¨æœŸ</span>
    sp<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token comment">// serverPrefetchç”Ÿå‘½å‘¨æœŸ</span>
  <span class="token punctuation">}</span>
 
  instance<span class="token punctuation">.</span>ctx <span class="token operator">=</span> <span class="token punctuation">{</span> _<span class="token operator">:</span> instance <span class="token punctuation">}</span> <span class="token comment">// åˆå§‹åŒ–æ¸²æŸ“ä¸Šä¸‹æ–‡</span>
  instance<span class="token punctuation">.</span>root <span class="token operator">=</span> parent <span class="token operator">?</span> parent<span class="token punctuation">.</span>root <span class="token operator">:</span> instance <span class="token comment">// èµ‹å€¼æ ¹ç»„ä»¶å®ä¾‹</span>
  instance<span class="token punctuation">.</span>emit <span class="token operator">=</span> <span class="token function">emit</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> instance<span class="token punctuation">)</span> <span class="token comment">// èµ‹å€¼è§¦å‘äº‹ä»¶å‡½æ•°</span>

  <span class="token keyword">return</span> instance
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»„ä»¶å®ä¾‹æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‡Œé¢æœ‰ä¸€äº›ç»„ä»¶çš„æ–¹æ³•ä»¥åŠå±æ€§ã€‚æ¥ç€å°±æ˜¯ç»„ä»¶å®ä¾‹çš„è®¾ç½®æµç¨‹ï¼Œé€šè¿‡å‡½æ•° <code>setupComponent</code> å®ç°</p><h2 id="è®¾ç½®ç»„ä»¶å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#è®¾ç½®ç»„ä»¶å®ä¾‹" aria-hidden="true">#</a> è®¾ç½®ç»„ä»¶å®ä¾‹</h2><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setupComponent</span><span class="token punctuation">(</span>
  instance<span class="token operator">:</span> ComponentInternalInstance<span class="token punctuation">,</span>
  isSSR <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// æœåŠ¡å™¨æ¸²æŸ“ç›¸å…³</span>
  isInSSRComponentSetup <span class="token operator">=</span> isSSR

  <span class="token keyword">const</span> <span class="token punctuation">{</span> props<span class="token punctuation">,</span> children <span class="token punctuation">}</span> <span class="token operator">=</span> instance<span class="token punctuation">.</span>vnode
  <span class="token comment">// åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶ï¼Œå…¶å®å°±æ˜¯ç»„ä»¶æ˜¯å¦æ˜¯ä¸€ä¸ªå¯¹è±¡</span>
  <span class="token keyword">const</span> isStateful <span class="token operator">=</span> <span class="token function">isStatefulComponent</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span>
  <span class="token comment">// åˆå§‹åŒ–props</span>
  <span class="token function">initProps</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> props<span class="token punctuation">,</span> isStateful<span class="token punctuation">,</span> isSSR<span class="token punctuation">)</span>
  <span class="token comment">// åˆå§‹åŒ–slots</span>
  <span class="token function">initSlots</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> children<span class="token punctuation">)</span>

  <span class="token comment">// è®¾ç½®çŠ¶æ€ç»„ä»¶</span>
  <span class="token keyword">const</span> setupResult <span class="token operator">=</span> isStateful
    <span class="token operator">?</span> <span class="token function">setupStatefulComponent</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> isSSR<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token keyword">undefined</span>
  isInSSRComponentSetup <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">return</span> setupResult
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>setupComponent</code> å‡½æ•°ä¸­è¿›è¡Œåˆå§‹åŒ–propså’Œslotsï¼Œè¿™éƒ¨åˆ†é€»è¾‘åœ¨åé¢åˆ†æï¼Œæ¥ç€åˆ¤æ–­å¦‚æœæœ‰çŠ¶æ€çš„ç»„ä»¶ï¼Œåˆ™é€šè¿‡ <code>setupStatefulComponent</code> å‡½æ•°è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">setupStatefulComponent</span><span class="token punctuation">(</span>
  instance<span class="token operator">:</span> ComponentInternalInstance<span class="token punctuation">,</span>
  isSSR<span class="token operator">:</span> <span class="token builtin">boolean</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Component <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token class-name"><span class="token keyword">as</span></span> ComponentOptions

  <span class="token comment">// åˆ›å»ºæ¸²æŸ“ä»£ç†å±æ€§ç¼“å­˜</span>
  instance<span class="token punctuation">.</span>accessCache <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token comment">// åˆ›å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡ä»£ç†</span>
  instance<span class="token punctuation">.</span>proxy <span class="token operator">=</span> <span class="token function">markRaw</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>ctx<span class="token punctuation">,</span> PublicInstanceProxyHandlers<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨setupå‡½æ•°</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> setup <span class="token punctuation">}</span> <span class="token operator">=</span> Component
  <span class="token keyword">if</span> <span class="token punctuation">(</span>setup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ›å»ºsetupä¸Šä¸‹æ–‡ï¼Œå‰ææ˜¯setupå‡½æ•°è‡³å°‘æœ‰ä¸€ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ä½¿ç”¨setupçš„ç¬¬ä¸€ä¸ªå‚æ•°çš„æ—¶å€™æ‰ä¼šåˆ›å»ºä¸Šä¸‹æ–‡ï¼‰</span>
    <span class="token keyword">const</span> setupContext <span class="token operator">=</span> <span class="token punctuation">(</span>instance<span class="token punctuation">.</span>setupContext <span class="token operator">=</span>
      setup<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token function">createSetupContext</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span>

    <span class="token comment">// è°ƒç”¨setup</span>
    <span class="token keyword">const</span> setupResult <span class="token operator">=</span> <span class="token function">callWithErrorHandling</span><span class="token punctuation">(</span>
      setup<span class="token punctuation">,</span>
      instance<span class="token punctuation">,</span>
      ErrorCodes<span class="token punctuation">.</span><span class="token constant">SETUP_FUNCTION</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span>instance<span class="token punctuation">.</span>props<span class="token punctuation">,</span> setupContext<span class="token punctuation">]</span>
    <span class="token punctuation">)</span>

    <span class="token comment">// åˆ¤æ–­setupè¿”å›å€¼</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPromise</span><span class="token punctuation">(</span>setupResult<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      setupResult<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>unsetCurrentInstance<span class="token punctuation">,</span> unsetCurrentInstance<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¤„ç†è¿”å›ç»“æœ</span>
      <span class="token function">handleSetupResult</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> setupResult<span class="token punctuation">,</span> isSSR<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// å®Œæˆè®¾ç½®ç»„ä»¶å®ä¾‹</span>
    <span class="token function">finishComponentSetup</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> isSSR<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>setupStatefulComponent</code> å‡½æ•°ä¸»è¦åšäº†å‡ ä»¶äº‹ï¼šåˆ›å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡ä»£ç†ã€è°ƒç”¨setupå‡½æ•°ã€å¤„ç†setupå‡½æ•°è¿”å›ç»“æœã€‚æˆ‘ä»¬é€ä¸ªåˆ†æ</p><h3 id="åˆ›å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡ä»£ç†" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡ä»£ç†" aria-hidden="true">#</a> åˆ›å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡ä»£ç†</h3><p>é¦–å…ˆè¦å¼„æ¸…æ¥šä¸ºä»€ä¹ˆè¦åˆ›å»ºä¸€ä¸ªä»£ç†</p><div class="language-vue line-numbers-mode" data-ext="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ msg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>vue2.xæ¯ä¸ªç»„ä»¶æ˜¯ä¸€ä¸ªVueå®ä¾‹ï¼Œåœ¨è·å–dataæˆ–propså±æ€§çš„çš„æ—¶å€™å¯ä»¥ç›´æ¥é€šè¿‡ <code>this.xxx</code> è·å–ï¼Œå®é™…ä¸Šè¿™äº›æ•°æ®æ˜¯å­˜æ”¾åœ¨å®ä¾‹çš„ <code>_data</code> å’Œ <code>_props</code> ä¸Šçš„ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œvueç”¨Object.definePropertyå°†å…¶ä¸­çš„å±æ€§éƒ½æŒ‚è½½åˆ°å®ä¾‹ä¸Šï¼Œåšäº†ä¸€å±‚ä»£ç†</p><p>åŒæ ·åœ¨vue3çš„å„ä¸ªç±»å‹çš„æ•°æ®ä¹Ÿæ˜¯å­˜æ”¾åœ¨setupStateã€ctxã€dataã€propsä¸­ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæ‰€æœ‰çš„è®¿é—®éƒ½åœ¨ç»„ä»¶å®ä¾‹æ¸²æŸ“ä¸Šä¸‹æ–‡ï¼ˆctxï¼‰ä¸Šè¿›è¡Œï¼Œæ‰€ä»¥éœ€è¦å¯¹ctxè¿›è¡Œä»£ç†ï¼Œå°†è®¿é—®çš„è¯·æ±‚åˆ†å‘åˆ°å„æ•°æ®å­˜æ”¾çš„ä½ç½®</p><p>ä»£ç†çš„é…ç½®æ˜¯ <code>PublicInstanceProxyHandlers</code>ï¼Œ<code>PublicInstanceProxyHandlers</code>é…ç½®äº†getã€setã€hasã€definePropertyï¼ˆæš‚ä¸ç ”ç©¶ï¼‰ï¼Œæˆ‘ä»¬é€ä¸ªåˆ†æ</p><h4 id="publicinstanceproxyhandlers-get" tabindex="-1"><a class="header-anchor" href="#publicinstanceproxyhandlers-get" aria-hidden="true">#</a> PublicInstanceProxyHandlers.get</h4><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> PublicInstanceProxyHandlers<span class="token operator">:</span> ProxyHandler<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _<span class="token operator">:</span> instance <span class="token punctuation">}</span><span class="token operator">:</span> ComponentRenderContext<span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">,</span> setupState<span class="token punctuation">,</span> data<span class="token punctuation">,</span> props<span class="token punctuation">,</span> accessCache<span class="token punctuation">,</span> type<span class="token punctuation">,</span> appContext <span class="token punctuation">}</span> <span class="token operator">=</span>
      instance

    <span class="token keyword">let</span> normalizedProps
    <span class="token comment">// å¤„ç†éå†…éƒ¨å±æ€§ $xxx</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">&#39;$&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å–ç¼“å­˜æ•°æ®</span>
      <span class="token keyword">const</span> n <span class="token operator">=</span> accessCache<span class="token operator">!</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ¤æ–­æœ‰ç¼“å­˜ï¼Œç›´æ¥å–æ•°æ®</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">case</span> AccessTypes<span class="token punctuation">.</span><span class="token constant">SETUP</span><span class="token operator">:</span>
            <span class="token keyword">return</span> setupState<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
          <span class="token keyword">case</span> AccessTypes<span class="token punctuation">.</span><span class="token constant">DATA</span><span class="token operator">:</span>
            <span class="token keyword">return</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
          <span class="token keyword">case</span> AccessTypes<span class="token punctuation">.</span><span class="token constant">CONTEXT</span><span class="token operator">:</span>
            <span class="token keyword">return</span> ctx<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
          <span class="token keyword">case</span> AccessTypes<span class="token punctuation">.</span><span class="token constant">PROPS</span><span class="token operator">:</span>
            <span class="token keyword">return</span> props<span class="token operator">!</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span>
          <span class="token comment">// default: just fallthrough</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasSetupBinding</span><span class="token punctuation">(</span>setupState<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ¤æ–­å¦‚æœæ˜¯setupStateçš„æ•°æ®ï¼Œè·å–æ•°æ®ï¼Œå­˜ç¼“å­˜ï¼Œè¿”å›</span>
        accessCache<span class="token operator">!</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> AccessTypes<span class="token punctuation">.</span><span class="token constant">SETUP</span>
        <span class="token keyword">return</span> setupState<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">!==</span> <span class="token constant">EMPTY_OBJ</span> <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¦‚æœæ˜¯dataä¸Šçš„æ•°æ®ï¼Œè·å–æ•°æ®ï¼Œå­˜ç¼“å­˜ï¼Œè¿”å›</span>
        accessCache<span class="token operator">!</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> AccessTypes<span class="token punctuation">.</span><span class="token constant">DATA</span>
        <span class="token keyword">return</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
        <span class="token comment">// only cache other properties when instance has declared (thus stable)</span>
        <span class="token comment">// props</span>
        <span class="token punctuation">(</span>normalizedProps <span class="token operator">=</span> instance<span class="token punctuation">.</span>propsOptions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token function">hasOwn</span><span class="token punctuation">(</span>normalizedProps<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¦‚æœæ˜¯propsä¸Šçš„æ•°æ®ï¼Œè·å–æ•°æ®ï¼Œå­˜ç¼“å­˜ï¼Œè¿”å›</span>
        accessCache<span class="token operator">!</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> AccessTypes<span class="token punctuation">.</span><span class="token constant">PROPS</span>
        <span class="token keyword">return</span> props<span class="token operator">!</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx <span class="token operator">!==</span> <span class="token constant">EMPTY_OBJ</span> <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¦‚æœæ˜¯ctxä¸Šçš„æ•°æ®ï¼Œè·å–æ•°æ®ï¼Œå­˜ç¼“å­˜ï¼Œè¿”å›</span>
        accessCache<span class="token operator">!</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> AccessTypes<span class="token punctuation">.</span><span class="token constant">CONTEXT</span>
        <span class="token keyword">return</span> ctx<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> publicGetter <span class="token operator">=</span> publicPropertiesMap<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">let</span> cssModule<span class="token punctuation">,</span> globalProperties
    <span class="token keyword">if</span> <span class="token punctuation">(</span>publicGetter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// åˆ¤æ–­å¦‚æœæ˜¯å†…éƒ¨å±æ€§æˆ–æ–¹æ³• $xxx</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">&#39;$attrs&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">track</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> TrackOpTypes<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token function">publicGetter</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
      <span class="token punctuation">(</span>cssModule <span class="token operator">=</span> type<span class="token punctuation">.</span>__cssModules<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
      <span class="token punctuation">(</span>cssModule <span class="token operator">=</span> cssModule<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// åˆ¤æ–­æ˜¯cssæ¨¡å—ï¼Œé€šè¿‡vue-loaderæ³¨å…¥</span>
      <span class="token keyword">return</span> cssModule
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx <span class="token operator">!==</span> <span class="token constant">EMPTY_OBJ</span> <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// åˆ¤æ–­æ˜¯ç”¨æˆ·è®¾ç½®çš„è‡ªå®šä¹‰å±æ€§ï¼Œä¹Ÿæ˜¯$å¼€å¤´</span>
      accessCache<span class="token operator">!</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> AccessTypes<span class="token punctuation">.</span><span class="token constant">CONTEXT</span>
      <span class="token keyword">return</span> ctx<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token punctuation">(</span>globalProperties <span class="token operator">=</span> appContext<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">hasOwn</span><span class="token punctuation">(</span>globalProperties<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// åˆ¤æ–­æ˜¯å…¨å±€å±æ€§</span>
      <span class="token keyword">return</span> globalProperties<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">has</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é¦–å…ˆæ˜¯è®¿é—®éå†…éƒ¨å±æ€§ï¼ˆé$å¼€å¤´çš„å±æ€§ï¼‰ï¼Œä¼šæ ¹æ®æ ¹æ®ç¼“å­˜æƒ…å†µå»å–æ•°æ®ï¼Œå¦‚æœæ²¡ç¼“å­˜åˆ™å–æ•°æ®å¹¶è®°å½•ç¼“å­˜ã€‚è¿™é‡Œçš„ç¼“å­˜å¯¹è±¡ <code>accessCache</code> éå¸¸æœ‰æ„æ€ï¼Œåªè®°å½•äº†æ•°æ®åç§°å’Œæ•°æ®ç±»å‹ï¼ˆAccessTypesï¼‰çš„æ˜ å°„ï¼Œé€šè¿‡ <code>hasOwn</code> å‡½æ•°éå†å¯¹è±¡ç¡®è®¤æ˜¯å¦å­˜åœ¨è¯¥å±æ€§çš„æ€§èƒ½ç›¸å¯¹ä½ä¸‹ï¼Œè€Œç›´æ¥å¯¹è±¡æ•°æ®è®¿é—®ï¼ˆobj[key]ï¼‰è·å–æ•°æ®æ€§èƒ½æ›´å¥½ï¼Œç¼“å­˜å¯¹è±¡ <code>accessCache</code> åªéœ€è¦è®°å½•è¯¥æ•°æ®çš„ç±»å‹å³å¯ï¼Œé‡å¤è®¿é—®å¯ä»¥ç›´æ¥æ ¹æ®ç¼“å­˜çš„æ•°æ®ç±»å‹å»å¯¹åº”çš„å¯¹è±¡ä¸­å–æ•°æ®</p><blockquote><p>è®¿é—®éå†…éƒ¨å±æ€§çš„é¡ºåºä¸º setupState &gt; data &gt; ctx &gt; props</p></blockquote><p>ä¹‹åå¦‚æœæ˜¯å†…éƒ¨å±æ€§æˆ–æ–¹æ³•ï¼ˆ$å¼€å¤´ï¼‰ï¼Œä¼šä¾æ¬¡åˆ¤æ–­å†…éƒ¨å±æ€§æˆ–æ–¹æ³•ã€cssæ¨¡å—ã€è‡ªå®šä¹‰å±æ€§ã€å…¨å±€å±æ€§ï¼Œå¹¶è¿”å›å¯¹åº”å€¼</p><h4 id="publicinstanceproxyhandlers-set" tabindex="-1"><a class="header-anchor" href="#publicinstanceproxyhandlers-set" aria-hidden="true">#</a> PublicInstanceProxyHandlers.set</h4><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> PublicInstanceProxyHandlers<span class="token operator">:</span> ProxyHandler<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">set</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> _<span class="token operator">:</span> instance <span class="token punctuation">}</span><span class="token operator">:</span> ComponentRenderContext<span class="token punctuation">,</span>
    key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    value<span class="token operator">:</span> <span class="token builtin">any</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> setupState<span class="token punctuation">,</span> ctx <span class="token punctuation">}</span> <span class="token operator">=</span> instance
    <span class="token comment">// å¦‚æœæ˜¯setupStateã€dataå±æ€§ç›´æ¥è®¾ç½®ï¼Œå¦‚æœæ˜¯propsåˆ™ä¸èƒ½è®¾ç½®</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasSetupBinding</span><span class="token punctuation">(</span>setupState<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      setupState<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">!==</span> <span class="token constant">EMPTY_OBJ</span> <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>props<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// å¦‚æœæ˜¯å†…éƒ¨å±æ€§ $xxx ä¸èƒ½è®¾ç½®ï¼Œå¦åˆ™è®¾ç½®æ¸²æŸ“ä¸Šä¸‹æ–‡ä¸­çš„æ•°æ®</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&#39;$&#39;</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">in</span> instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      ctx<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">has</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>set</code> é…ç½®é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œå¯¹ä¸€äº›å±æ€§èµ‹å€¼è¿›è¡Œäº†é™åˆ¶ã€‚å¦‚æœæ˜¯setupStateã€dataå±æ€§å¯ä»¥è¿›è¡Œèµ‹å€¼ï¼Œå¦‚æœæ˜¯å†…éƒ¨å±æ€§åˆ™ä¸èƒ½å¤åˆ¶ï¼Œå¦‚æœä»¥ä¸Šæƒ…å†µéƒ½ä¸æ˜¯åˆ™ç»™æ¸²æŸ“ä¸Šä¸‹æ–‡èµ‹å€¼ï¼ˆctxï¼‰</p><p>è¿™é‡Œæ¸²æŸ“ä¸Šä¸‹æ–‡èµ‹å€¼çš„æƒ…å†µå±äºsetupå‡½æ•°æ²¡æœ‰è¿”å›è¯¥å±æ€§ã€dataä¸­æ²¡æœ‰é…ç½®è¯¥å±æ€§ã€propsä¸­ä¹Ÿæ²¡æœ‰è¯¥å±æ€§ï¼Œä¾‹å¦‚ï¼š</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token string">&#39;data&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>å¯èµ‹å€¼å±æ€§é¡ºåº setupState &gt; data &gt; ctx</p></blockquote><h4 id="publicinstanceproxyhandlers-has" tabindex="-1"><a class="header-anchor" href="#publicinstanceproxyhandlers-has" aria-hidden="true">#</a> PublicInstanceProxyHandlers.has</h4><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> PublicInstanceProxyHandlers<span class="token operator">:</span> ProxyHandler<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">has</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
      _<span class="token operator">:</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> setupState<span class="token punctuation">,</span> accessCache<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> appContext<span class="token punctuation">,</span> propsOptions <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token operator">:</span> ComponentRenderContext<span class="token punctuation">,</span>
    key<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> normalizedProps
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">!</span><span class="token operator">!</span>accessCache<span class="token operator">!</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">||</span>
      <span class="token punctuation">(</span>data <span class="token operator">!==</span> <span class="token constant">EMPTY_OBJ</span> <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
      <span class="token function">hasSetupBinding</span><span class="token punctuation">(</span>setupState<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token operator">||</span>
      <span class="token punctuation">(</span><span class="token punctuation">(</span>normalizedProps <span class="token operator">=</span> propsOptions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>normalizedProps<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
      <span class="token function">hasOwn</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token operator">||</span>
      <span class="token function">hasOwn</span><span class="token punctuation">(</span>publicPropertiesMap<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token operator">||</span>
      <span class="token function">hasOwn</span><span class="token punctuation">(</span>appContext<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>has</code>ï¼Œæ–¹æ³•å°±æ˜¯åœ¨éå†çš„æ—¶å€™æŒ‰ç…§ä¸€å®šé¡ºåºåˆ¤æ–­æ˜¯å¦å­˜åœ¨æŸå€¼ï¼šæ¸²æŸ“å±æ€§ç¼“å­˜ï¼ˆaccessCacheï¼‰ &gt; data &gt; setupState &gt; props &gt; æ¸²æŸ“ä¸Šä¸‹æ–‡ï¼ˆctxï¼‰ &gt; å†…éƒ¨å±æ€§$xxx &gt; å…¨å±€å±æ€§</p><h3 id="è°ƒç”¨setupå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#è°ƒç”¨setupå‡½æ•°" aria-hidden="true">#</a> è°ƒç”¨setupå‡½æ•°</h3><p>æ•°æ®å­˜æ”¾åœ¨ç»„ä»¶å®ä¾‹çš„å„ä¸ªå±æ€§ä¸‹ï¼Œæ¸²æŸ“ä¸Šä¸‹æ–‡ä»£ç†å®é™…ä¸Šæ˜¯å°†è¿™äº›å±æ€§ä»£ç†åˆ°æ¸²æŸ“ä¸Šä¸‹æ–‡ï¼ˆcxtï¼‰ä¸­ï¼Œç»Ÿä¸€æ•°æ®è®¿é—®å…¥å£ã€‚æ¥ç€å›åˆ° <code>setupStatefulComponent</code> å‡½æ•°ä¸­</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨setupå‡½æ•°</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> setup <span class="token punctuation">}</span> <span class="token operator">=</span> Component
<span class="token keyword">if</span> <span class="token punctuation">(</span>setup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åˆ›å»ºsetupä¸Šä¸‹æ–‡ï¼Œå‰ææ˜¯setupå‡½æ•°è‡³å°‘æœ‰ä¸€ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ä½¿ç”¨setupçš„ç¬¬ä¸€ä¸ªå‚æ•°çš„æ—¶å€™æ‰ä¼šåˆ›å»ºä¸Šä¸‹æ–‡ï¼‰</span>
  <span class="token keyword">const</span> setupContext <span class="token operator">=</span> <span class="token punctuation">(</span>instance<span class="token punctuation">.</span>setupContext <span class="token operator">=</span>
    setup<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token function">createSetupContext</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span>

  <span class="token comment">// è°ƒç”¨setup</span>
  <span class="token keyword">const</span> setupResult <span class="token operator">=</span> <span class="token function">callWithErrorHandling</span><span class="token punctuation">(</span>
    setup<span class="token punctuation">,</span>
    instance<span class="token punctuation">,</span>
    ErrorCodes<span class="token punctuation">.</span><span class="token constant">SETUP_FUNCTION</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>instance<span class="token punctuation">.</span>props<span class="token punctuation">,</span> setupContext<span class="token punctuation">]</span>
  <span class="token punctuation">)</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é¦–å…ˆæ ¹æ®setupå‡½æ•°å‚æ•°åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ›å»ºsetupä¸Šä¸‹æ–‡ï¼Œæ„æ€å¦‚ä¸‹ï¼š</p><div class="language-vue line-numbers-mode" data-ext="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ data }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onClick<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>click<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> String
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> <span class="token punctuation">{</span> emit <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">function</span> <span class="token function">onClick</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;onClick&#39;</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        onClick
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚ä¸Šé¢ä¾‹å­ï¼Œ<code>setup</code> æ¥æ”¶äº†ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯propsï¼Œç¬¬äºŒä¸ªå°±æ˜¯setupä¸Šä¸‹æ–‡ã€‚å…·ä½“setupä¸Šä¸‹æ–‡çš„å®ç°åœ¨ <code>createSetupContext</code> å‡½æ•°ä¸­</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createSetupContext</span><span class="token punctuation">(</span>
  instance<span class="token operator">:</span> ComponentInternalInstance
<span class="token punctuation">)</span><span class="token operator">:</span> SetupContext <span class="token punctuation">{</span>
  <span class="token keyword">const</span> expose<span class="token operator">:</span> SetupContext<span class="token punctuation">[</span><span class="token string">&#39;expose&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> exposed <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    instance<span class="token punctuation">.</span>exposed <span class="token operator">=</span> exposed <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> attrs<span class="token operator">:</span> Data
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token function">attrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> attrs <span class="token operator">||</span> <span class="token punctuation">(</span>attrs <span class="token operator">=</span> <span class="token function">createAttrsProxy</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    slots<span class="token operator">:</span> instance<span class="token punctuation">.</span>slots<span class="token punctuation">,</span>
    emit<span class="token operator">:</span> instance<span class="token punctuation">.</span>emit<span class="token punctuation">,</span>
    expose
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°setupä¸Šä¸‹æ–‡å°±æ˜¯å¯¹ç»„ä»¶å®ä¾‹ä¸Šéƒ¨åˆ†å±æ€§è¿›è¡Œäº†å°è£…ï¼Œå®é™…ä¸Šè°ƒç”¨æ–¹æ³•æˆ–æ“ä½œæ•°æ®è¿˜æ˜¯åœ¨ç»„ä»¶å®ä¾‹ä¸Š</p><p>æ¥ç€æˆ‘ä»¬å›åˆ° <code>setupStatefulComponent</code> å‡½æ•°ä¸­ç»§ç»­åˆ†æï¼Œæ‰§è¡Œsetupå‡½æ•°æ˜¯é€šè¿‡ <code>callWithErrorHandling</code> å‡½æ•°è°ƒç”¨</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">const</span> setupResult <span class="token operator">=</span> <span class="token function">callWithErrorHandling</span><span class="token punctuation">(</span>
  setup<span class="token punctuation">,</span>
  instance<span class="token punctuation">,</span>
  ErrorCodes<span class="token punctuation">.</span><span class="token constant">SETUP_FUNCTION</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>instance<span class="token punctuation">.</span>props<span class="token punctuation">,</span> setupContext<span class="token punctuation">]</span>
<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">callWithErrorHandling</span><span class="token punctuation">(</span>
  fn<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">,</span>
  instance<span class="token operator">:</span> ComponentInternalInstance <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  type<span class="token operator">:</span> ErrorTypes<span class="token punctuation">,</span>
  args<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> res
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    res <span class="token operator">=</span> args <span class="token operator">?</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">handleError</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> type<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> res
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>callWithErrorHandling</code> å‡½æ•°åªæ˜¯æ‰§è¡Œäº†ä¼ å…¥å‡½æ•°ï¼Œå¹¶å¤„ç†æŠ¥é”™ã€‚å¯ä»¥çœ‹åˆ°setupå‡½æ•°çš„ç¬¬ä¸€ç¬¬äºŒå‚æ•°å°±æ˜¯ <code>callWithErrorHandling</code> å‡½æ•°ä¼ å…¥çš„ <code>[instance.props, setupContext]</code></p><h3 id="å¤„ç†setupå‡½æ•°è¿”å›ç»“æœ" tabindex="-1"><a class="header-anchor" href="#å¤„ç†setupå‡½æ•°è¿”å›ç»“æœ" aria-hidden="true">#</a> å¤„ç†setupå‡½æ•°è¿”å›ç»“æœ</h3><p>è°ƒç”¨setupçš„é€»è¾‘å°±æ˜¯è·å–ä½¿ç”¨setupå‡½æ•°å‚æ•°æƒ…å†µè¿›è¡Œå‚æ•°æ„å»ºï¼Œå¹¶è°ƒç”¨setupå‡½æ•°å°†æ„å»ºå¥½çš„å‚æ•°ä¼ å…¥ï¼Œè·å¾—setupå‡½æ•°çš„è¿”å›å€¼ <code>setupResult</code>ã€‚æˆ‘ä»¬å†æ¬¡å›åˆ° <code>setupStatefulComponent</code> å‡½æ•°çœ‹å¦‚ä½•å¤„ç†setupè¿”å›ç»“æœ <code>setupResult</code></p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token function">handleSetupResult</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> setupResult<span class="token punctuation">,</span> isSSR<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>é€šè¿‡ <code>handleSetupResult</code> å‡½æ•°å¤„ç† <code>setupResult</code></p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">handleSetupResult</span><span class="token punctuation">(</span>
  instance<span class="token operator">:</span> ComponentInternalInstance<span class="token punctuation">,</span>
  setupResult<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span>
  isSSR<span class="token operator">:</span> <span class="token builtin">boolean</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>setupResult<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ¤æ–­æ˜¯æ¸²æŸ“å‡½æ•°</span>
    instance<span class="token punctuation">.</span>render <span class="token operator">=</span> setupResult <span class="token keyword">as</span> InternalRenderFunction
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>setupResult<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ¤æ–­æ˜¯å¯¹è±¡ï¼Œå°†è¿”å›å€¼è½¬åŒ–æˆå“åº”å¼</span>
    instance<span class="token punctuation">.</span>setupState <span class="token operator">=</span> <span class="token function">proxyRefs</span><span class="token punctuation">(</span>setupResult<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// å®Œæˆç»„ä»¶å®ä¾‹è®¾ç½®</span>
  <span class="token function">finishComponentSetup</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> isSSR<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>handleSetupResult</code> å‡½æ•°æ ¹æ® <code>setupResult</code>ï¼ˆsetupå‡½æ•°è¿”å›å€¼ï¼‰çš„ç±»å‹åšä¸åŒå¤„ç†ï¼Œå¦‚æœæ˜¯å‡½æ•°åˆ™è®¤ä¸ºæ˜¯æ¸²æŸ“å‡½æ•°æŒ‚è½½åˆ°ç»„ä»¶å®ä¾‹ä¸Šï¼ˆsetupå¯ä»¥è¿”å›ä¸€ä¸ªæ¸²æŸ“å‡½æ•°ï¼‰ï¼Œå¦‚æœæ˜¯å¯¹è±¡åˆ™è½¬åŒ–æˆå“åº”å¼æŒ‚è½½åˆ°ç»„ä»¶å®ä¾‹ï¼Œè¿™æ ·setupå‡½æ•°å’Œå½“å‰ç»„ä»¶å°±å…³è”ä¸Šäº†ã€‚æœ€åè°ƒç”¨ <code>finishComponentSetup</code> å®Œæˆç»„ä»¶å®ä¾‹çš„è®¾ç½®</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">finishComponentSetup</span><span class="token punctuation">(</span>
  instance<span class="token operator">:</span> ComponentInternalInstance<span class="token punctuation">,</span>
  isSSR<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span>
  skipOptions<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Component <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token class-name"><span class="token keyword">as</span></span> ComponentOptions

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">.</span>render<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ¤æ–­ç»„ä»¶å®ä¾‹ä¸Šæ²¡æœ‰renderå‡½æ•°</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isSSR <span class="token operator">&amp;&amp;</span> compile <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Component<span class="token punctuation">.</span>render<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ä¸æ˜¯æœåŠ¡å™¨æ¸²æŸ“ï¼Œä¸”ä½¿ç”¨äº†runtime-onlyç‰ˆæœ¬ï¼Œä¸”è¯¥ç»„ä»¶æ²¡æœ‰renderå‡½æ•°</span>

      <span class="token comment">// è·å–æ¨¡æ¿</span>
      <span class="token keyword">const</span> template <span class="token operator">=</span>
        <span class="token punctuation">(</span>__COMPAT__ <span class="token operator">&amp;&amp;</span>
          instance<span class="token punctuation">.</span>vnode<span class="token punctuation">.</span>props <span class="token operator">&amp;&amp;</span>
          instance<span class="token punctuation">.</span>vnode<span class="token punctuation">.</span>props<span class="token punctuation">[</span><span class="token string">&#39;inline-template&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span>
        Component<span class="token punctuation">.</span>template <span class="token operator">||</span>
        <span class="token function">resolveMergedOptions</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">.</span>template
      <span class="token keyword">if</span> <span class="token punctuation">(</span>template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ ¹æ®ç»„ä»¶é…ç½®å’Œç»„ä»¶æ¨¡æ¿ç”Ÿæˆrenderå‡½æ•°</span>

        <span class="token comment">// è¿™é‡Œé…ç½®ä¼˜å…ˆçº§æ˜¯ ç»„ä»¶é…ç½® &gt; å…¨å±€é…ç½®</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> isCustomElement<span class="token punctuation">,</span> compilerOptions <span class="token punctuation">}</span> <span class="token operator">=</span> instance<span class="token punctuation">.</span>appContext<span class="token punctuation">.</span>config
        <span class="token keyword">const</span> <span class="token punctuation">{</span> delimiters<span class="token punctuation">,</span> compilerOptions<span class="token operator">:</span> componentCompilerOptions <span class="token punctuation">}</span> <span class="token operator">=</span>
          Component
        <span class="token keyword">const</span> finalCompilerOptions<span class="token operator">:</span> CompilerOptions <span class="token operator">=</span> <span class="token function">extend</span><span class="token punctuation">(</span>
          <span class="token function">extend</span><span class="token punctuation">(</span>
            <span class="token punctuation">{</span>
              isCustomElement<span class="token punctuation">,</span>
              delimiters
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            compilerOptions
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          componentCompilerOptions
        <span class="token punctuation">)</span>

        <span class="token comment">// ç”Ÿæˆrenderå‡½æ•°</span>
        Component<span class="token punctuation">.</span>render <span class="token operator">=</span> <span class="token function">compile</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> finalCompilerOptions<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ç»„ä»¶å®ä¾‹çš„renderå‡½æ•°å°±æ˜¯ç»„ä»¶çš„renderå‡½æ•°</span>
    instance<span class="token punctuation">.</span>render <span class="token operator">=</span> <span class="token punctuation">(</span>Component<span class="token punctuation">.</span>render <span class="token operator">||</span> <span class="token constant">NOOP</span><span class="token punctuation">)</span> <span class="token keyword">as</span> InternalRenderFunction

    <span class="token comment">// å¯¹ä½¿ç”¨withå—ï¼Œä½¿ç”¨æ–°çš„ä¸Šä¸‹æ–‡ä»£ç†</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>installWithProxy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">installWithProxy</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>finishComponentSetup</code> å‡½æ•°ä¸»è¦ä½œç”¨åœ¨äºï¼Œæ ¹æ®ç»„ä»¶é…ç½®å’Œç»„ä»¶æ¨¡æ¿ç”Ÿæˆè¯¥ç»„ä»¶çš„renderå‡½æ•°ï¼Œå¹¶æŒ‚åœ¨è‡³ç»„ä»¶å®ä¾‹ä¸Š</p><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2><p>è¿™ç« ä¸»è¦åˆ†æç»„ä»¶åœ¨æ¸²æŸ“vnodeä¹‹å‰çš„é€»è¾‘ï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºç»„ä»¶å®ä¾‹ï¼Œæ¥ç€è®¾ç½®ç»„ä»¶å®ä¾‹ã€‚åœ¨è®¾ç½®ç»„ä»¶å®ä¾‹ä¸­äº†è§£ä¸ºä»€ä¹ˆéœ€è¦æ¸²æŸ“ä¸Šä¸‹æ–‡ä»£ç†ä»¥åŠåˆ›å»ºé€»è¾‘ï¼Œäº†è§£ä¹‹åè°ƒç”¨setupå‡½æ•°æ—¶æœºä»¥åŠå‚æ•°ç”Ÿæˆï¼Œä»¥åŠæœ€åå¤„ç†setupå‡½æ•°çš„è¿”å›å€¼å¹¶ç”Ÿæˆè¯¥ç»„ä»¶çš„renderå‡½æ•°æŒ‚è½½è‡³å±æ€§å®ä¾‹ä¸Š</p><p><img src="/assets/init.2f3098ce.png" alt=""></p><h2 id="é™„åŠ " tabindex="-1"><a class="header-anchor" href="#é™„åŠ " aria-hidden="true">#</a> é™„åŠ </h2><h3 id="runtime-onlyå’Œruntime-compiledç‰ˆæœ¬" tabindex="-1"><a class="header-anchor" href="#runtime-onlyå’Œruntime-compiledç‰ˆæœ¬" aria-hidden="true">#</a> runtime-onlyå’Œruntime-compiledç‰ˆæœ¬</h3><p>vueç»„ä»¶æœ€ç»ˆæ˜¯é€šè¿‡renderå‡½æ•°ç”Ÿæˆçš„vnodeæ ‘ï¼Œrenderæ˜¯ä»£ç ä¸­ç¼–å†™çš„æ¨¡æ¿ç¼–è¯‘ç”Ÿæˆï¼Œå¦‚æœé¡¹ç›®æ˜¯ç”¨webpackæ„å»ºï¼Œå¯ä»¥é€šè¿‡vue-loaderå°†æ¨¡æ¿ç¼–è¯‘ç”Ÿæˆrenderã€‚å¦‚æœç›´æ¥å¼•å…¥vueä½¿ç”¨ï¼Œvueæœ¬èº«ä¹Ÿè‡ªå¸¦ç¼–è¯‘å‡½æ•°compileè¿›è¡Œç¼–è¯‘æ¨¡æ¿</p><p>è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæœ‰runtime-onlyå’Œruntime-compiledç‰ˆæœ¬ï¼ŒåŒºåˆ«åœ¨äºæ˜¯å¦æœ‰compileå‡½æ•°ã€‚å¦‚æœé¡¹ç›®ä½¿ç”¨webpack + vue-loaderæ„å»ºï¼Œå»ºè®®ä½¿ç”¨runtime-onlyç‰ˆæœ¬å‡å°‘æ‰“åŒ…ä½“ç§¯ã€‚å¦‚æœé¡¹ç›®ç›´æ¥å¼•å…¥vueåˆ™éœ€è¦ä½¿ç”¨runtime-compiledç‰ˆæœ¬</p><p>vue3çš„compileæ–¹æ³•æ˜¯é€šè¿‡å‡½æ•°æ³¨å†Œçš„</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">let</span> compile<span class="token operator">:</span> CompileFunction <span class="token operator">|</span> <span class="token keyword">undefined</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">registerRuntimeCompiler</span><span class="token punctuation">(</span>_compile<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  compile <span class="token operator">=</span> _compile
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¸ºä»€ä¹ˆè°ƒç”¨setupéœ€è¦é€šè¿‡callwitherrorhandlingå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè°ƒç”¨setupéœ€è¦é€šè¿‡callwitherrorhandlingå‡½æ•°" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆè°ƒç”¨setupéœ€è¦é€šè¿‡callWithErrorHandlingå‡½æ•°</h3><p>æˆ‘ä»¬è¿›å…¥è¯¥å‡½æ•°å†…éƒ¨æŸ¥çœ‹</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">callWithErrorHandling</span><span class="token punctuation">(</span>
  fn<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">,</span>
  instance<span class="token operator">:</span> ComponentInternalInstance <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  type<span class="token operator">:</span> ErrorTypes<span class="token punctuation">,</span>
  args<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> res
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    res <span class="token operator">=</span> args <span class="token operator">?</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">handleError</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> type<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> res
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœsetupå‡½æ•°æŠ¥é”™ï¼Œè¿™é‡Œè¿›å…¥ <code>handleError</code> å‡½æ•°å¤„ç†</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">handleError</span><span class="token punctuation">(</span>
  err<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span>
  instance<span class="token operator">:</span> ComponentInternalInstance <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  type<span class="token operator">:</span> ErrorTypes<span class="token punctuation">,</span>
  throwInDev <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> contextVNode <span class="token operator">=</span> instance <span class="token operator">?</span> instance<span class="token punctuation">.</span>vnode <span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä»å½“å‰ç»„ä»¶å‘ä¸Šå†’æ³¡ï¼Œè§¦å‘çˆ¶ç»„ä»¶ã€ç¥–çˆ¶ç»„ä»¶çš„errorCapturedç”Ÿå‘½å‘¨æœŸï¼Œç›´åˆ°æ ¹ç»„ä»¶</span>
    <span class="token keyword">let</span> cur <span class="token operator">=</span> instance<span class="token punctuation">.</span>parent
    <span class="token keyword">const</span> exposedInstance <span class="token operator">=</span> instance<span class="token punctuation">.</span>proxy
    <span class="token keyword">const</span> errorInfo <span class="token operator">=</span> <span class="token keyword">type</span>
    <span class="token class-name"><span class="token keyword">while</span></span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> errorCapturedHooks <span class="token operator">=</span> cur<span class="token punctuation">.</span>ec
      <span class="token keyword">if</span> <span class="token punctuation">(</span>errorCapturedHooks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> errorCapturedHooks<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>errorCapturedHooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> exposedInstance<span class="token punctuation">,</span> errorInfo<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      cur <span class="token operator">=</span> cur<span class="token punctuation">.</span>parent
    <span class="token punctuation">}</span>
    <span class="token comment">// è°ƒç”¨å…¨å±€é…ç½®çš„errorHandlerå‡½æ•°</span>
    <span class="token keyword">const</span> appErrorHandler <span class="token operator">=</span> instance<span class="token punctuation">.</span>appContext<span class="token punctuation">.</span>config<span class="token punctuation">.</span>errorHandler
    <span class="token keyword">if</span> <span class="token punctuation">(</span>appErrorHandler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">callWithErrorHandling</span><span class="token punctuation">(</span>
        appErrorHandler<span class="token punctuation">,</span>
        <span class="token keyword">null</span><span class="token punctuation">,</span>
        ErrorCodes<span class="token punctuation">.</span><span class="token constant">APP_ERROR_HANDLER</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>err<span class="token punctuation">,</span> exposedInstance<span class="token punctuation">,</span> errorInfo<span class="token punctuation">]</span>
      <span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// è®°å½•é”™è¯¯ä¿¡æ¯</span>
  <span class="token function">logError</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> type<span class="token punctuation">,</span> contextVNode<span class="token punctuation">,</span> throwInDev<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>handleError</code> å‡½æ•°å°†é”™è¯¯å‘ä¸Šå†’æ³¡ï¼Œè°ƒç”¨çˆ¶çº§ç»„ä»¶çš„errorCapturedç”Ÿå‘½å‘¨æœŸç›´åˆ°æ ¹ç»„ä»¶ï¼Œä¹‹åè°ƒç”¨å…¨å±€é…ç½®çš„errorHandlerå‡½æ•°ï¼Œæœ€åè®°å½•é”™è¯¯</p></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: marx10086@gmail.com">marx</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/vue3%E6%BA%90%E7%A0%81/2.diff%E6%B5%81%E7%A8%8B.html" class="nav-link prev" aria-label="diffæµç¨‹ï¼ˆç»„ä»¶æ›´æ–°ï¼‰"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->diffæµç¨‹ï¼ˆç»„ä»¶æ›´æ–°ï¼‰</div></a><a href="/vue3%E6%BA%90%E7%A0%81/4.%E5%93%8D%E5%BA%94%E5%BC%8F.html" class="nav-link next" aria-label="å“åº”å¼"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow right"></span></div><div class="link">å“åº”å¼<!----></div></a></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.9ac9284b.js" defer></script>
  </body>
</html>
