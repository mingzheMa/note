# 项目构建相关

这里并不探讨vue3的源码，只是为了学习vue3项目构建中使用的一些技术

## monorepo 仓库管理方式

vue3使用的是 **monorepo** 和 **TypeScript** 管理和开发代码，monorepo解释为单体仓库（mono repo），将耦合度高或依赖性强的项目整合到一个仓库下，通过人为的规则将这些项目划分开

vue3目录如下，将各个功能拆分出单个项目，都放在 <code>vue3/core/packages</code> 中

```txt
vue3/core
├── packages
│   ├── compiler-core
│   ├── compiler-dom
│   ├── compiler-sfc
│   ├── compiler-ssr
│   ├── reactivity
│   ├── reactivity-transform
│   ├── runtime-core
│   ├── runtime-dom
│   ├── runtime-test
│   ├── server-renderer
│   ├── sfc-playground
│   ├── shared
│   ├── size-check
│   ├── template-explorer
│   ├── vue
└── └── vue-compat
```

### monorepo 和 multirepos

**multirepos** 是多体仓库，这是比较常用的管理方式，每一个仓库下只存放该项目的代码

从multirepos迁移到monorepo，就是将所有仓库都合并在一起

```txt
/project1
/project2
/project3

↑ 合并为 ↓

/monorepo/project/project1
/monorepo/project/project2
/monorepo/project/project3
```

### monorepo 优点

- **代码透明**，业务相关的项目都在一个仓库中，使得某个项目组可以观察到所有项目的代码，更好的团队协作
- **更好的依赖管理**，一些公共库不需要包管理工具，直接根据路径导入
- **版本冲突**，由于公共库直接导入使用，所以该项目使用的公共库一直是最新版本，减少版本冲突
- **代码风格**，有利于统一整个代码风格
- **重大更新**，某个项目有重大变更其他的项目组在拉取代码时可以观察到，如果与变更项目依赖部分产生影响能及时发现
- **重构或更新**，如果一个业务穿插多个项目，可以在一个分支中完成
- **CI/CD**，可以使用同一套CI/CD部署

### monorepo 缺点

- **仓库庞大**，一些全局的命令会非常耗时，例如：git pull
- **污染主分支**，如果一个问题分支合并到主分支上，可能会影响所有项目，比较考验开发和审核的规则以及相关人员的素质
- **commit增多审查困难**，合并仓库就会导致commit增多，导致code review困难
- **权限管理**，gitHub并没有仓库下文件的管理系统

### monorepo 最佳实践

- 规范仓库中项目目录，便于查找
- 尽量保持分支的纯净
- 一次性提升所有依赖，减少出现版本冲突的情况
- git中使用浅克隆和分支过滤处理仓库
- 使用一些monorepo管理器，例如：lerna