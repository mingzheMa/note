<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.53" />
    <meta name="theme" content="VuePress Theme Hope" />
    <title>中间件 | marx的学习笔记</title><meta name="description" content="部分内容是参考外部文章，属于个人复习使用">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/note/assets/style.31e87fe8.css" as="style" /><link rel="stylesheet" href="/note/assets/style.31e87fe8.css" />
    <link rel="modulepreload" href="/note/assets/app.002a81c8.js"><link rel="modulepreload" href="/note/assets/4.中间件.html.8c241230.js"><link rel="modulepreload" href="/note/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/note/assets/4.中间件.html.efc8b7e4.js"><link rel="prefetch" href="/note/assets/index.html.6c946c9f.js" as="script" /><link rel="prefetch" href="/note/assets/ES6和CommonJS模块化.html.993609d3.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.c3b5ae80.js" as="script" /><link rel="prefetch" href="/note/assets/indexedDB.html.c8a10585.js" as="script" /><link rel="prefetch" href="/note/assets/包装类型.html.6ad5c91c.js" as="script" /><link rel="prefetch" href="/note/assets/循环.html.6c09574e.js" as="script" /><link rel="prefetch" href="/note/assets/手写CommonJS.html.1498b864.js" as="script" /><link rel="prefetch" href="/note/assets/手写Promise.html.a9d665da.js" as="script" /><link rel="prefetch" href="/note/assets/生成器.html.30c11bf8.js" as="script" /><link rel="prefetch" href="/note/assets/类型转换.html.1c90490a.js" as="script" /><link rel="prefetch" href="/note/assets/运算符.html.7cbf200a.js" as="script" /><link rel="prefetch" href="/note/assets/迭代器.html.09e1ba62.js" as="script" /><link rel="prefetch" href="/note/assets/0.React中的TS集成.html.72297c73.js" as="script" /><link rel="prefetch" href="/note/assets/0.TSConfig配置.html.8e862c7f.js" as="script" /><link rel="prefetch" href="/note/assets/0.infer关键字.html.2de3f009.js" as="script" /><link rel="prefetch" href="/note/assets/0.内置工具.html.d0be95a8.js" as="script" /><link rel="prefetch" href="/note/assets/0.函数重载.html.472f247a.js" as="script" /><link rel="prefetch" href="/note/assets/0.抽象类.html.73a87988.js" as="script" /><link rel="prefetch" href="/note/assets/0.断言函数.html.7e02431c.js" as="script" /><link rel="prefetch" href="/note/assets/0.模板字符串.html.ff0f7d9a.js" as="script" /><link rel="prefetch" href="/note/assets/0.模板字符串工具.html.37bd6f59.js" as="script" /><link rel="prefetch" href="/note/assets/0.类型层级.html.d19219c6.js" as="script" /><link rel="prefetch" href="/note/assets/0.类的方法覆盖.html.a293b1d6.js" as="script" /><link rel="prefetch" href="/note/assets/0.静态类.html.8181c739.js" as="script" /><link rel="prefetch" href="/note/assets/100.实现对某个对象部分属性进行修饰.html.c90c47fd.js" as="script" /><link rel="prefetch" href="/note/assets/101.实现对象属性互斥类型工具.html.1c88a8bf.js" as="script" /><link rel="prefetch" href="/note/assets/102.实现对象类型的交叉并补集.html.c34a2ab0.js" as="script" /><link rel="prefetch" href="/note/assets/103.实现提取某个对象中必选属性.html.1b540263.js" as="script" /><link rel="prefetch" href="/note/assets/104.实现Pick和Omit函数对属性值提取.html.5493e78d.js" as="script" /><link rel="prefetch" href="/note/assets/105.实现对象数组深层修饰.html.d35935ad.js" as="script" /><link rel="prefetch" href="/note/assets/106.实现解析URL参数.html.f9754bc4.js" as="script" /><link rel="prefetch" href="/note/assets/99.type-challenges.html.972c803b.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.cec00e38.js" as="script" /><link rel="prefetch" href="/note/assets/HOOK.html.d697ab33.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.644c3b34.js" as="script" /><link rel="prefetch" href="/note/assets/Ref.html.82fe80d4.js" as="script" /><link rel="prefetch" href="/note/assets/渲染原理.html.0965e517.js" as="script" /><link rel="prefetch" href="/note/assets/1.核心概念.html.c41f806b.js" as="script" /><link rel="prefetch" href="/note/assets/2.简单使用.html.35b02576.js" as="script" /><link rel="prefetch" href="/note/assets/3.实现简易Redux.html.e69c76e0.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.0390cf8c.js" as="script" /><link rel="prefetch" href="/note/assets/1.项目构建.html.46395daf.js" as="script" /><link rel="prefetch" href="/note/assets/2.css工程化.html.8346221e.js" as="script" /><link rel="prefetch" href="/note/assets/3.接入ESLint.html.bd4f3b49.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.c01df283.js" as="script" /><link rel="prefetch" href="/note/assets/1.install.html.ff2fa99b.js" as="script" /><link rel="prefetch" href="/note/assets/2.VueRouter构造器.html.4daaa82a.js" as="script" /><link rel="prefetch" href="/note/assets/3.matcher.html.57e7a6fe.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.f9ad7a4b.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.c73209a9.js" as="script" /><link rel="prefetch" href="/note/assets/1.vnode到dom.html.32d400a2.js" as="script" /><link rel="prefetch" href="/note/assets/100.项目构建.html.e929feeb.js" as="script" /><link rel="prefetch" href="/note/assets/2.diff流程.html.6096dd78.js" as="script" /><link rel="prefetch" href="/note/assets/3.setup.html.0cbe3bc3.js" as="script" /><link rel="prefetch" href="/note/assets/4.响应式.html.6333cda8.js" as="script" /><link rel="prefetch" href="/note/assets/5.计算属性.html.1deab00e.js" as="script" /><link rel="prefetch" href="/note/assets/6.监听器.html.9e4328c2.js" as="script" /><link rel="prefetch" href="/note/assets/7.异步队列.html.1e11bab4.js" as="script" /><link rel="prefetch" href="/note/assets/8.生命周期钩子.html.ce05d4d9.js" as="script" /><link rel="prefetch" href="/note/assets/9.依赖注入.html.ae06bc47.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.b28797b1.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.d4641eb2.js" as="script" /><link rel="prefetch" href="/note/assets/optimization.html.b1c39f99.js" as="script" /><link rel="prefetch" href="/note/assets/如何处理let为var.html.347b2682.js" as="script" /><link rel="prefetch" href="/note/assets/按需引入.html.a1796dd7.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.34f02707.js" as="script" /><link rel="prefetch" href="/note/assets/http1.0、1.1、2.0、3.0的区别.html.6c1be5f5.js" as="script" /><link rel="prefetch" href="/note/assets/性能优化.html.e967da4a.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.c8bbff92.js" as="script" /><link rel="prefetch" href="/note/assets/1.current.html.ee6a17a4.js" as="script" /><link rel="prefetch" href="/note/assets/2.confirmTransition.html.1e08f473.js" as="script" /><link rel="prefetch" href="/note/assets/3.路由守卫.html.893eaf6b.js" as="script" /><link rel="prefetch" href="/note/assets/4.url.html.9292353d.js" as="script" /><link rel="prefetch" href="/note/assets/5.内置组件.html.5418707b.js" as="script" /><link rel="prefetch" href="/note/assets/6.总结.html.63a80113.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.24076b77.js" as="script" /><link rel="prefetch" href="/note/assets/1.目录结构.html.d9612b02.js" as="script" /><link rel="prefetch" href="/note/assets/2.源码构建.html.e031a84b.js" as="script" /><link rel="prefetch" href="/note/assets/3.vue入口.html.e6400f8b.js" as="script" /><link rel="prefetch" href="/note/assets/1.介绍.html.15428a35.js" as="script" /><link rel="prefetch" href="/note/assets/2.new Vue发生了什么.html.ffc7e372.js" as="script" /><link rel="prefetch" href="/note/assets/3.Vue._mount.html.f6f138d2.js" as="script" /><link rel="prefetch" href="/note/assets/4.Vue._render.html.e91241ea.js" as="script" /><link rel="prefetch" href="/note/assets/5.VNode.html.a9e8a3e2.js" as="script" /><link rel="prefetch" href="/note/assets/6.createElement.html.203ebab0.js" as="script" /><link rel="prefetch" href="/note/assets/7.Vue._update.html.d4975f38.js" as="script" /><link rel="prefetch" href="/note/assets/1.介绍.html.a23cd9c1.js" as="script" /><link rel="prefetch" href="/note/assets/2.createComponent.html.57dccc1a.js" as="script" /><link rel="prefetch" href="/note/assets/3.patch.html.a97ff2e4.js" as="script" /><link rel="prefetch" href="/note/assets/1.介绍.html.3a17ad55.js" as="script" /><link rel="prefetch" href="/note/assets/2.响应式对象.html.ea1d4db3.js" as="script" /><link rel="prefetch" href="/note/assets/3.依赖收集.html.7b50dfa2.js" as="script" /><link rel="prefetch" href="/note/assets/4.派发更新.html.ae5d0c6a.js" as="script" /><link rel="prefetch" href="/note/assets/5._nexttick.html.7edd0ede.js" as="script" /><link rel="prefetch" href="/note/assets/6.检测数据变化.html.2155d52d.js" as="script" /><link rel="prefetch" href="/note/assets/7.计算属性和监听属性.html.5b224810.js" as="script" /><link rel="prefetch" href="/note/assets/1.keep-alive.html.36b34e0c.js" as="script" /><link rel="prefetch" href="/note/assets/响应式.html.b1602ed1.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.4be7c4be.js" as="script" /><link rel="prefetch" href="/note/assets/vue更新粒度如何控制在组件级别.html.0c9c3af5.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.ef1b8444.js" as="script" /><link rel="prefetch" href="/note/assets/hash和history优缺点.html.c381588f.js" as="script" /><link rel="prefetch" href="/note/assets/404.html.c5de7dd9.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.45ed5f7d.js" as="script" /><link rel="prefetch" href="/note/assets/ES6和CommonJS模块化.html.e34e6387.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.3a6a05c2.js" as="script" /><link rel="prefetch" href="/note/assets/indexedDB.html.486cad56.js" as="script" /><link rel="prefetch" href="/note/assets/包装类型.html.c68366e8.js" as="script" /><link rel="prefetch" href="/note/assets/循环.html.e101299b.js" as="script" /><link rel="prefetch" href="/note/assets/手写CommonJS.html.1836c47d.js" as="script" /><link rel="prefetch" href="/note/assets/手写Promise.html.5bf5f6b0.js" as="script" /><link rel="prefetch" href="/note/assets/生成器.html.8ed161ba.js" as="script" /><link rel="prefetch" href="/note/assets/类型转换.html.92e8fa87.js" as="script" /><link rel="prefetch" href="/note/assets/运算符.html.3c13b47c.js" as="script" /><link rel="prefetch" href="/note/assets/迭代器.html.e7ed0694.js" as="script" /><link rel="prefetch" href="/note/assets/0.React中的TS集成.html.6ad62cb2.js" as="script" /><link rel="prefetch" href="/note/assets/0.TSConfig配置.html.4c2db2af.js" as="script" /><link rel="prefetch" href="/note/assets/0.infer关键字.html.6b8da2a2.js" as="script" /><link rel="prefetch" href="/note/assets/0.内置工具.html.e6e81e31.js" as="script" /><link rel="prefetch" href="/note/assets/0.函数重载.html.fc5d6aa5.js" as="script" /><link rel="prefetch" href="/note/assets/0.抽象类.html.8e946822.js" as="script" /><link rel="prefetch" href="/note/assets/0.断言函数.html.04ce2893.js" as="script" /><link rel="prefetch" href="/note/assets/0.模板字符串.html.55168d0c.js" as="script" /><link rel="prefetch" href="/note/assets/0.模板字符串工具.html.c2e84ead.js" as="script" /><link rel="prefetch" href="/note/assets/0.类型层级.html.2a734992.js" as="script" /><link rel="prefetch" href="/note/assets/0.类的方法覆盖.html.ec1822ee.js" as="script" /><link rel="prefetch" href="/note/assets/0.静态类.html.f7fe831e.js" as="script" /><link rel="prefetch" href="/note/assets/100.实现对某个对象部分属性进行修饰.html.4c99c1e6.js" as="script" /><link rel="prefetch" href="/note/assets/101.实现对象属性互斥类型工具.html.df9aa9a8.js" as="script" /><link rel="prefetch" href="/note/assets/102.实现对象类型的交叉并补集.html.96120ab4.js" as="script" /><link rel="prefetch" href="/note/assets/103.实现提取某个对象中必选属性.html.77950696.js" as="script" /><link rel="prefetch" href="/note/assets/104.实现Pick和Omit函数对属性值提取.html.e5f0083f.js" as="script" /><link rel="prefetch" href="/note/assets/105.实现对象数组深层修饰.html.37b71c5d.js" as="script" /><link rel="prefetch" href="/note/assets/106.实现解析URL参数.html.27b2c9ca.js" as="script" /><link rel="prefetch" href="/note/assets/99.type-challenges.html.5fcf4f3a.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.4fec250c.js" as="script" /><link rel="prefetch" href="/note/assets/HOOK.html.8c5e17a8.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.b1df8b96.js" as="script" /><link rel="prefetch" href="/note/assets/Ref.html.84a0fd5d.js" as="script" /><link rel="prefetch" href="/note/assets/渲染原理.html.379ac5ef.js" as="script" /><link rel="prefetch" href="/note/assets/1.核心概念.html.b9dbdbe9.js" as="script" /><link rel="prefetch" href="/note/assets/2.简单使用.html.e557e0d9.js" as="script" /><link rel="prefetch" href="/note/assets/3.实现简易Redux.html.02412614.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.2c708232.js" as="script" /><link rel="prefetch" href="/note/assets/1.项目构建.html.4256751b.js" as="script" /><link rel="prefetch" href="/note/assets/2.css工程化.html.af756110.js" as="script" /><link rel="prefetch" href="/note/assets/3.接入ESLint.html.08e58d8b.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.b0493fce.js" as="script" /><link rel="prefetch" href="/note/assets/1.install.html.e232e2dc.js" as="script" /><link rel="prefetch" href="/note/assets/2.VueRouter构造器.html.0b4321d2.js" as="script" /><link rel="prefetch" href="/note/assets/3.matcher.html.886bd4a1.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.1508f14b.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.463c5d87.js" as="script" /><link rel="prefetch" href="/note/assets/1.vnode到dom.html.c13939dc.js" as="script" /><link rel="prefetch" href="/note/assets/100.项目构建.html.c5843798.js" as="script" /><link rel="prefetch" href="/note/assets/2.diff流程.html.8dd2e794.js" as="script" /><link rel="prefetch" href="/note/assets/3.setup.html.bca5554a.js" as="script" /><link rel="prefetch" href="/note/assets/4.响应式.html.cbd0936d.js" as="script" /><link rel="prefetch" href="/note/assets/5.计算属性.html.62692b37.js" as="script" /><link rel="prefetch" href="/note/assets/6.监听器.html.d7f7f25b.js" as="script" /><link rel="prefetch" href="/note/assets/7.异步队列.html.4bfebd27.js" as="script" /><link rel="prefetch" href="/note/assets/8.生命周期钩子.html.6e698415.js" as="script" /><link rel="prefetch" href="/note/assets/9.依赖注入.html.fcb908a9.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.19a51118.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.02516bac.js" as="script" /><link rel="prefetch" href="/note/assets/optimization.html.7c8c6707.js" as="script" /><link rel="prefetch" href="/note/assets/如何处理let为var.html.fc4fa984.js" as="script" /><link rel="prefetch" href="/note/assets/按需引入.html.eccdc77b.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.210e7d99.js" as="script" /><link rel="prefetch" href="/note/assets/http1.0、1.1、2.0、3.0的区别.html.806bb893.js" as="script" /><link rel="prefetch" href="/note/assets/性能优化.html.958cae0c.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.4ecefa1a.js" as="script" /><link rel="prefetch" href="/note/assets/1.current.html.e3e49497.js" as="script" /><link rel="prefetch" href="/note/assets/2.confirmTransition.html.7794c09a.js" as="script" /><link rel="prefetch" href="/note/assets/3.路由守卫.html.2f41bdeb.js" as="script" /><link rel="prefetch" href="/note/assets/4.url.html.511dacc3.js" as="script" /><link rel="prefetch" href="/note/assets/5.内置组件.html.c3746686.js" as="script" /><link rel="prefetch" href="/note/assets/6.总结.html.f277e7a5.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.5f81f194.js" as="script" /><link rel="prefetch" href="/note/assets/1.目录结构.html.816b5e18.js" as="script" /><link rel="prefetch" href="/note/assets/2.源码构建.html.a25affc8.js" as="script" /><link rel="prefetch" href="/note/assets/3.vue入口.html.7c0cd77c.js" as="script" /><link rel="prefetch" href="/note/assets/1.介绍.html.dfd9d380.js" as="script" /><link rel="prefetch" href="/note/assets/2.new Vue发生了什么.html.f9ff4af7.js" as="script" /><link rel="prefetch" href="/note/assets/3.Vue._mount.html.1c590864.js" as="script" /><link rel="prefetch" href="/note/assets/4.Vue._render.html.7d29cec2.js" as="script" /><link rel="prefetch" href="/note/assets/5.VNode.html.a948faae.js" as="script" /><link rel="prefetch" href="/note/assets/6.createElement.html.fedf547c.js" as="script" /><link rel="prefetch" href="/note/assets/7.Vue._update.html.915d9ea9.js" as="script" /><link rel="prefetch" href="/note/assets/1.介绍.html.4e56cb90.js" as="script" /><link rel="prefetch" href="/note/assets/2.createComponent.html.3d111296.js" as="script" /><link rel="prefetch" href="/note/assets/3.patch.html.e30dd072.js" as="script" /><link rel="prefetch" href="/note/assets/1.介绍.html.b228538f.js" as="script" /><link rel="prefetch" href="/note/assets/2.响应式对象.html.ca078649.js" as="script" /><link rel="prefetch" href="/note/assets/3.依赖收集.html.8c30101c.js" as="script" /><link rel="prefetch" href="/note/assets/4.派发更新.html.643ceb67.js" as="script" /><link rel="prefetch" href="/note/assets/5._nexttick.html.25246fea.js" as="script" /><link rel="prefetch" href="/note/assets/6.检测数据变化.html.707200bf.js" as="script" /><link rel="prefetch" href="/note/assets/7.计算属性和监听属性.html.86ea6c54.js" as="script" /><link rel="prefetch" href="/note/assets/1.keep-alive.html.181eeecf.js" as="script" /><link rel="prefetch" href="/note/assets/响应式.html.56fbaedc.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.123f89ed.js" as="script" /><link rel="prefetch" href="/note/assets/vue更新粒度如何控制在组件级别.html.ae57f022.js" as="script" /><link rel="prefetch" href="/note/assets/index.html.f4f56558.js" as="script" /><link rel="prefetch" href="/note/assets/hash和history优缺点.html.1636f998.js" as="script" /><link rel="prefetch" href="/note/assets/404.html.37c2ace2.js" as="script" /><link rel="prefetch" href="/note/assets/photoswipe.esm.720e8656.js" as="script" />
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/note/" class="brand"><!----><!----><span class="site-name">marx的学习笔记</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/note/JS/" class="nav-link" aria-label="JS"><!---->JS<!----></a></div><div class="nav-item hide-in-mobile"><a href="/note/TS/" class="nav-link" aria-label="TS"><!---->TS<!----></a></div><div class="nav-item hide-in-mobile"><a href="/note/webpack/" class="nav-link" aria-label="webpack"><!---->webpack<!----></a></div><div class="nav-item hide-in-mobile"><a href="/note/vite/" class="nav-link" aria-label="vite"><!---->vite<!----></a></div><div class="nav-item hide-in-mobile"><a href="/note/react/" class="nav-link" aria-label="react"><!---->react<!----></a></div><div class="nav-item hide-in-mobile"><a href="/note/redux/" class="nav-link active" aria-label="redux"><!---->redux<!----></a></div><div class="nav-item hide-in-mobile"><a href="/note/vue2%E6%BA%90%E7%A0%81/" class="nav-link" aria-label="vue2源码"><!---->vue2源码<!----></a></div><div class="nav-item hide-in-mobile"><a href="/note/vue3%E6%BA%90%E7%A0%81/" class="nav-link" aria-label="vue3源码"><!---->vue3源码<!----></a></div><div class="nav-item hide-in-mobile"><a href="/note/vue-router3%E6%BA%90%E7%A0%81/" class="nav-link" aria-label="vue-router3源码"><!---->vue-router3源码<!----></a></div><div class="nav-item hide-in-mobile"><a href="/note/%E7%BD%91%E7%BB%9C/" class="nav-link" aria-label="网络"><!---->网络<!----></a></div><div class="nav-item hide-in-mobile"><a href="/note/%E9%9D%A2%E8%AF%95%E9%A2%98/" class="nav-link" aria-label="面试题"><!---->面试题<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><!----><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/note/redux/" class="nav-link sidebar-link sidebar-page" aria-label="首页"><!---->首页<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/note/redux/1.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5.html" class="nav-link sidebar-link sidebar-page" aria-label="核心概念"><!---->核心概念<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/note/redux/2.%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8.html" class="nav-link sidebar-link sidebar-page" aria-label="简单使用"><!---->简单使用<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/note/redux/3.%E5%AE%9E%E7%8E%B0%E7%AE%80%E6%98%93Redux.html" class="nav-link sidebar-link sidebar-page" aria-label="实现简易Redux"><!---->实现简易Redux<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="中间件"><!---->中间件<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#redux-logger" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="redux-logger"><!---->redux-logger<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#redux-thunk" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="redux-thunk"><!---->redux-thunk<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#redux-promise" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="redux-promise"><!---->redux-promise<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#redux-saga" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="redux-saga"><!---->redux-saga<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#take创建器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="take创建器"><!---->take创建器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#all组合器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="all组合器"><!---->all组合器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#race组合器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="race组合器"><!---->race组合器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#takeevery辅助函数" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="takeEvery辅助函数"><!---->takeEvery辅助函数<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#delay工具" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="delay工具"><!---->delay工具<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#put创建器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="put创建器"><!---->put创建器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#call创建器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="call创建器"><!---->call创建器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#apply创建器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="apply创建器"><!---->apply创建器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#cps创建器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="cps创建器"><!---->cps创建器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#select创建器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="select创建器"><!---->select创建器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#fork创建器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="fork创建器"><!---->fork创建器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#cancel创建器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="cancel创建器"><!---->cancel创建器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#takelatest辅助函数" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="takeLatest辅助函数"><!---->takeLatest辅助函数<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#例子-实现takeevery" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="例子：实现takeEvery"><!---->例子：实现takeEvery<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#例子-实现takelatest" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="例子：实现takeLatest"><!---->例子：实现takeLatest<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#例子-流程管理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="例子：流程管理"><!---->例子：流程管理<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#redux-actions" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="redux-actions"><!---->redux-actions<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#createaction-s" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="createAction(s)"><!---->createAction(s)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#handleaction-s" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="handleAction(s)"><!---->handleAction(s)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#combineactions" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="combineActions"><!---->combineActions<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->中间件</h1><div class="page-info"><!----><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-12-02T09:12:10.000Z"></span><!----><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 13 分钟</span><meta property="timeRequired" content="PT13M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#redux-logger" class="router-link-active router-link-exact-active toc-link level2">redux-logger</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#redux-thunk" class="router-link-active router-link-exact-active toc-link level2">redux-thunk</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#redux-promise" class="router-link-active router-link-exact-active toc-link level2">redux-promise</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#redux-saga" class="router-link-active router-link-exact-active toc-link level2">redux-saga</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#take创建器" class="router-link-active router-link-exact-active toc-link level3">take创建器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#all组合器" class="router-link-active router-link-exact-active toc-link level3">all组合器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#race组合器" class="router-link-active router-link-exact-active toc-link level3">race组合器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#takeevery辅助函数" class="router-link-active router-link-exact-active toc-link level3">takeEvery辅助函数</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#delay工具" class="router-link-active router-link-exact-active toc-link level3">delay工具</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#put创建器" class="router-link-active router-link-exact-active toc-link level3">put创建器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#call创建器" class="router-link-active router-link-exact-active toc-link level3">call创建器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#apply创建器" class="router-link-active router-link-exact-active toc-link level3">apply创建器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#cps创建器" class="router-link-active router-link-exact-active toc-link level3">cps创建器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#select创建器" class="router-link-active router-link-exact-active toc-link level3">select创建器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#fork创建器" class="router-link-active router-link-exact-active toc-link level3">fork创建器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#cancel创建器" class="router-link-active router-link-exact-active toc-link level3">cancel创建器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#takelatest辅助函数" class="router-link-active router-link-exact-active toc-link level3">takeLatest辅助函数</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#例子-实现takeevery" class="router-link-active router-link-exact-active toc-link level3">例子：实现takeEvery</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#例子-实现takelatest" class="router-link-active router-link-exact-active toc-link level3">例子：实现takeLatest</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#例子-流程管理" class="router-link-active router-link-exact-active toc-link level3">例子：流程管理</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#redux-actions" class="router-link-active router-link-exact-active toc-link level2">redux-actions</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#createaction-s" class="router-link-active router-link-exact-active toc-link level3">createAction(s)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#handleaction-s" class="router-link-active router-link-exact-active toc-link level3">handleAction(s)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/redux/4.%E4%B8%AD%E9%97%B4%E4%BB%B6.html#combineactions" class="router-link-active router-link-exact-active toc-link level3">combineActions</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="中间件" tabindex="-1"><a class="header-anchor" href="#中间件" aria-hidden="true">#</a> 中间件</h1><p>介绍一些比较实用的中间件</p><h2 id="redux-logger" tabindex="-1"><a class="header-anchor" href="#redux-logger" aria-hidden="true">#</a> redux-logger</h2><p>记录store状态修改，<a href="https://www.npmjs.com/package/redux-logger" target="_blank" rel="noopener noreferrer">使用比较简单<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="redux-thunk" tabindex="-1"><a class="header-anchor" href="#redux-thunk" aria-hidden="true">#</a> redux-thunk</h2><p>如果我们想在dispatch的时候提交的action为函数，可以使用这个中间件，简单搞个场景</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;SET_LOADING&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token keyword">await</span> accountApi<span class="token punctuation">.</span><span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;SET_USER_INFO&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">payload</span><span class="token operator">:</span> userInfo
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;SET_LOADING&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>例如我们有个页面，在初始化的时候需要获取数据，在展示数据之前需要有loading，我们需要再组件中维护这些逻辑，如果这个逻辑被很多地方复用了</p><blockquote><p>这个例子不是很恰当，这些数据完全不需要redux，而且如果逻辑要共享可以将<code>init</code>函数提出做一个utils，这里只是为了演示</p></blockquote><p>我们可以使用<code>redux-thunk</code>来解决这个耦合的问题，<code>redux-thunk</code>可以允许我们提交的action为一个函数</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> applyMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span>
<span class="token keyword">import</span> thunk <span class="token keyword">from</span> <span class="token string">&quot;redux-thunk&quot;</span>
<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">&quot;./reducer&quot;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>pageInitAction<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">pageInitAction</span><span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span> getState</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;SET_LOADING&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token keyword">await</span> accountApi<span class="token punctuation">.</span><span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;SET_USER_INFO&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">payload</span><span class="token operator">:</span> userInfo
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;SET_LOADING&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到我们提交了一个函数<code>pageInitAction</code>，调用<code>store.dispatch(pageInitAction)</code>函数会被触发，并传入两个参数，<code>dispatch</code>就是更新仓库的方法，<code>getState</code>就是获取当前仓库状态的方法</p><blockquote><p>实际上redux-thunk中间件会判断提交的action是否为函数，如果是函数则调用函数传入对应参数，并中断这次dispatch流程。这也意味着如果配置了多个中间件，redux-thunk中间件需要放置第一个，因为中间件的调用顺序和添加顺序一致</p></blockquote><h2 id="redux-promise" tabindex="-1"><a class="header-anchor" href="#redux-promise" aria-hidden="true">#</a> redux-promise</h2><p>用法和redux-thunk类似，只是action是一个promise，具体参考<a href="https://www.npmjs.com/package/redux-promise" target="_blank" rel="noopener noreferrer">官方文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="redux-saga" tabindex="-1"><a class="header-anchor" href="#redux-saga" aria-hidden="true">#</a> redux-saga</h2><p>saga中间件可以叨叨thunk中间件的效果，但与之不同的是saga可以不破坏action的结构来完成，而且其功能强大，这里只是简单介绍，具体内容参考<a href="https://redux-saga-in-chinese.js.org/" target="_blank" rel="noopener noreferrer">中文文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> applyMiddleware <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;redux&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> createSagaMiddleware <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;redux-saga&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> take <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;redux-saga/effects&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sagaMiddleware <span class="token operator">=</span> <span class="token function">createSagaMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> defaultState <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> defaultState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;EDIT_DATA&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> <span class="token string">&quot;DELETE_DATA&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>sagaMiddleware<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">saga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">&quot;SET_USER_INFO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;action：SET_USER_INFO执行了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

sagaMiddleware<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>saga<span class="token punctuation">)</span><span class="token punctuation">;</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;SET_USER_INFO&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token string">&quot;hhh&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们写一个简单的例子，在每次调用<code>dispatch</code>传入的<code>action.type</code>的值为<code>SET_USER_INFO</code>时，就会触发打印<code>action：SET_USER_INFO执行了</code></p><p>saga库分为两个部分，一个是中间件的部分，一个是副作用部分，中间件部分通过<code>createSagaMiddleware</code>创建一个saga中间件，以及<code>run</code>方法挂载saga任务</p><p>saga任务是一个generator函数，在调用<code>run</code>方法的时候就会执行，需要通过<code>yield</code>关键字阻塞saga任务，<code>yield</code>关键字后面就是saga副作用</p><p>saga任务在执行完毕后就关闭，不会再次执行，因此我们可以使用一些手段使saga任务永远不要执行完毕</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">saga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">&quot;SET_USER_INFO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;action：SET_USER_INFO执行了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样在每次执行完<code>take</code>副作用后就会进入循环，当碰到<code>yield</code>关键字时就会阻塞，稍后我们介绍一些常用的副作用</p><blockquote><p>所有副作用需要yield关键字，用来被saga任务控制</p></blockquote><h3 id="take创建器" tabindex="-1"><a class="header-anchor" href="#take创建器" aria-hidden="true">#</a> take创建器</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">saga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">&quot;SET_USER_INFO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;action：SET_USER_INFO执行了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>take</code>副作用可以传入action.type、函数、数组、&quot;*&quot;，这里传入action.type，当dispatch的action.type是<code>SET_USER_INFO</code>时就会触发saga任务的next，调用console</p><h3 id="all组合器" tabindex="-1"><a class="header-anchor" href="#all组合器" aria-hidden="true">#</a> all组合器</h3><p>如果我们需要拦截多个action进行各自的操作那么就需要写多个<code>yield</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">saga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">&quot;SET_USER_INFO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;action：SET_USER_INFO执行了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">&quot;GET_USER_INFO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;action：GET_USER_INFO执行了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE_USER_INFO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;action：DELETE_USER_INFO执行了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果没有工程化的分割在大型项目中saga任务会变得非常臃肿难以维护，我们可以使用<code>all</code>组合器</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">userSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">&quot;SET_USER_INFO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;action：SET_USER_INFO执行了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">&quot;GET_USER_INFO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;action：GET_USER_INFO执行了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE_USER_INFO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;action：DELETE_USER_INFO执行了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">userSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样我们拆出了<code>userSaga</code>，<code>userSaga</code>中使用了<code>while (true)</code>无限循环，所以<code>userSaga</code>函数不会结束，<code>rootSaga</code>函数也不会结束</p><blockquote><p>all中所有任务结束all才会结束</p></blockquote><h3 id="race组合器" tabindex="-1"><a class="header-anchor" href="#race组合器" aria-hidden="true">#</a> race组合器</h3><p>用法和all一样，如果有其中一个任务完成，则直接结束</p><h3 id="takeevery辅助函数" tabindex="-1"><a class="header-anchor" href="#takeevery辅助函数" aria-hidden="true">#</a> takeEvery辅助函数</h3><p>是take（创建器）和fork（创建器）组合出来的函数，功能和take类似用来捕获提交的action</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">monitorEditDataAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;EDIT_DATA action提交了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">monitorDeleteDataAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE_DATA action提交了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 第一个参数和take一样，第二个就是匹配action后触发的回调函数</span>
  <span class="token keyword">yield</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span><span class="token string">&quot;EDIT_DATA&quot;</span><span class="token punctuation">,</span> monitorEditDataAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE_DATA&quot;</span><span class="token punctuation">,</span> monitorDeleteDataAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;rootSaga执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;EDIT_DATA&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token string">&quot;hhh&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;DELETE_DATA&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// console：</span>
<span class="token comment">// rootSaga执行</span>
<span class="token comment">// EDIT_DATA action提交了</span>
<span class="token comment">// DELETE_DATA action提交了</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>takeEvery辅助函数有几个特点：</p><ul><li>不会阻塞saga任务，可以看出一开始就输出了<code>rootSaga执行</code></li><li>saga任务中如果有takeEvery辅助函数则saga任务不会结束</li><li>可配置多个takeEvery辅助函数分别对应不同的action</li><li>takeEvery会将action传递到监听函数中，为最后一个参数</li></ul><h3 id="delay工具" tabindex="-1"><a class="header-anchor" href="#delay工具" aria-hidden="true">#</a> delay工具</h3><p>用于阻塞saga任务</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> val <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&quot;参数1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;rootSaga执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// console（1s后）：</span>
<span class="token comment">// 参数1</span>
<span class="token comment">// rootSaga执行</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>delay工具接收两个参数：第一个阻塞时间。第二个返回参数，默认是true</p><h3 id="put创建器" tabindex="-1"><a class="header-anchor" href="#put创建器" aria-hidden="true">#</a> put创建器</h3><p>用于向store提交一个action，不会阻塞后续任务</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">monitorEditDataAction</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;DELETE_DATA&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;提交了action&quot;</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span><span class="token string">&quot;EDIT_DATA&quot;</span><span class="token punctuation">,</span> monitorEditDataAction<span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;rootSaga执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;EDIT_DATA&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token string">&quot;hhh&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// console</span>
<span class="token comment">// rootSaga执行</span>
<span class="token comment">// 提交了action { type: &#39;EDIT_DATA&#39;, payload: &#39;hhh&#39; }</span>
<span class="token comment">// { data: null }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>例如我们监听<code>EDIT_DATA</code>的action提交，每当该action提交的时候我们就提交<code>DELETE_DATA</code>的action给它删除</p><p>put可以传一个action进去，在执行到此处的时候会自动提交action</p><h3 id="call创建器" tabindex="-1"><a class="header-anchor" href="#call创建器" aria-hidden="true">#</a> call创建器</h3><p>call是用来解决异步函数（返回promise），会阻塞saga任务等待异步函数返回值，类似于async/await</p><p>generator函数是可以处理promise的，我们假设一个场景</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">res</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id为</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">的data数据</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">monitorGetDataAction</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getData</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;EDIT_DATA&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">payload</span><span class="token operator">:</span> res<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span><span class="token string">&quot;GET_DATA&quot;</span><span class="token punctuation">,</span> monitorGetDataAction<span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;rootSaga执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

sagaMiddleware<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>rootSaga<span class="token punctuation">)</span><span class="token punctuation">;</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;GET_DATA&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// console:</span>
<span class="token comment">// rootSaga执行</span>
<span class="token comment">// { data: &#39;id为1的data数据&#39; }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>比如我们需要根据id获取数据，并改变store的状态</p><ul><li>提交一个<code>GET_DATA</code>的action，并带上id</li><li>通过<code>takeEvery</code>匹配action出发监听函数<code>monitorGetDataAction</code></li><li><code>monitorGetDataAction</code>函数中通过<code>getData</code>请求数据</li><li>获取数据后通过<code>put</code>提交修改数据</li></ul><p>如果我们在yield关键字后面跟函数的话会有些迷惑，不知道是saga提供的副作用还是自定义的函数，并且也不方便单元测试，如果统一逻辑yield关键字后面必须跟saga副作用的话我们就需要call创建器来解决</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">monitorGetDataAction</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>getData<span class="token punctuation">,</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;EDIT_DATA&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">payload</span><span class="token operator">:</span> res<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>效果和刚才是一样的，第一个参数传异步函数，第二个参数传异步函数参数，当然call的传参形式是多样的，也可以配置this指向</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">this</span>指向<span class="token punctuation">,</span> 异步函数<span class="token punctuation">]</span><span class="token punctuation">,</span> 函数参数（可以多个）<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="apply创建器" tabindex="-1"><a class="header-anchor" href="#apply创建器" aria-hidden="true">#</a> apply创建器</h3><p>效果和call类似，只是传参方式不一样</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">apply</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token punctuation">[</span>prop1<span class="token punctuation">,</span> prop2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="cps创建器" tabindex="-1"><a class="header-anchor" href="#cps创建器" aria-hidden="true">#</a> cps创建器</h3><p>效果和call类似，如果异步函数是以回调的方式使用则需要cps创建器</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">id为</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">的data数据</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">cps</span><span class="token punctuation">(</span>getData<span class="token punctuation">,</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>替换call中的例子可以获得相同的效果，注意回调函数在调用的时候第一个参数表示错误参数，如果传递可以使用try/catch捕获cps得到错误</p><h3 id="select创建器" tabindex="-1"><a class="header-anchor" href="#select创建器" aria-hidden="true">#</a> select创建器</h3><p>阻塞saga任务，用来获取store中的当前状态，我们还拿call的例子稍作修改</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>
<span class="token keyword">const</span> defaultState <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">monitorGetDataAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>getData<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;EDIT_DATA&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">payload</span><span class="token operator">:</span> res<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span><span class="token string">&quot;GET_DATA&quot;</span><span class="token punctuation">,</span> monitorGetDataAction<span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;rootSaga执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;GET_DATA&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// condole</span>
<span class="token comment">// rootSaga执行</span>
<span class="token comment">// { data: &#39;id为1的data数据&#39;, id: 1 }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里我们获取数据的id是从仓库中获取，通过select副作用可以获得当前store的状态，副作用可以传递一个函数筛选获取的状态，如果不传则获取整个store的状态</p><h3 id="fork创建器" tabindex="-1"><a class="header-anchor" href="#fork创建器" aria-hidden="true">#</a> fork创建器</h3><p>fork用于创建一个新任务，不会阻塞和停止原有任务，返回一个Task类型的对象，用于停止任务</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">dataFork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">&quot;GET_DATA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GET_DATA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>dataFork<span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;rootSaga执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;GET_DATA&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// console:</span>
<span class="token comment">// rootSaga执行</span>
<span class="token comment">// GET_DATA</span>
<span class="token comment">// GET_DATA </span>
<span class="token comment">// ...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>fork创建任务需要一个generate函数，函数内使用和saga任务一样</p><h3 id="cancel创建器" tabindex="-1"><a class="header-anchor" href="#cancel创建器" aria-hidden="true">#</a> cancel创建器</h3><p>用于停止任务，传入一个任务则停止该任务，如果不传参数则停止当前任务</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> task <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span><span class="token string">&quot;GET_DATA&quot;</span><span class="token punctuation">,</span> monitorGetDataAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token function">cancel</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;rootSaga执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们在saga任务开始的时候就取消了takeEvery任务，这样就永远不会触发 <code>monitorGetDataAction</code> 函数</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> task <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">monitorGetDataAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> <span class="token function">cancel</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">yield</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GET_DATA action提交了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  task <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span><span class="token string">&quot;GET_DATA&quot;</span><span class="token punctuation">,</span> monitorGetDataAction<span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;rootSaga执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你想一开始就阻止takeEvery任务，这么写是不行的，因为每次匹配action的时候takeEvery都会新创建一个任务，防止 <code>monitorGetDataAction</code> 函数阻塞</p><h3 id="takelatest辅助函数" tabindex="-1"><a class="header-anchor" href="#takelatest辅助函数" aria-hidden="true">#</a> takeLatest辅助函数</h3><p>功能和takeEvery类似，多次匹配action只会执行最后一次，类似防抖</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">monitorGetDataAction</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GET_DATA action提交了&quot;</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">takeLatest</span><span class="token punctuation">(</span><span class="token string">&quot;GET_DATA&quot;</span><span class="token punctuation">,</span> monitorGetDataAction<span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;rootSaga执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;GET_DATA&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;GET_DATA&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// rootSaga执行</span>
<span class="token comment">// GET_DATA action提交了 { type: &#39;GET_DATA&#39;, payload: 2 }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>例如快速触发两次action，只会触发最后一次action的监听</p><h3 id="例子-实现takeevery" tabindex="-1"><a class="header-anchor" href="#例子-实现takeevery" aria-hidden="true">#</a> 例子：实现takeEvery</h3><p>takeEvery辅助函数内部就是通过fork实现的，我们模拟下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">takeEveryCopy</span><span class="token punctuation">(</span><span class="token parameter">actionType<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span>actionType<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">monitorGetDataAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;GAT_DATA action提交了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">takeEveryCopy</span><span class="token punctuation">(</span><span class="token string">&quot;GET_DATA&quot;</span><span class="token punctuation">,</span> monitorGetDataAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>首先我们需要梳理takeEvery的逻辑：不会阻塞saga任务、不会结束saga任务、每次匹配都会触发监听函数</p><p>接下来我们看 <code>takeEveryCopy</code> 函数，首先返回一个 <code>fork</code>，<code>fork</code>是子任务，不会阻塞以及结束saga任务，使用 <code>take</code> 监听action，触发监听函数这里我们又开了一个任务去调用监听函数，其目的是禁止 <code>cb</code> 函数阻塞 <code>take</code> 监听，例如我们快速触发多次 <code>GET_DATA</code>，第一次就会被 <code>cb</code> 函数阻塞，没有办法运行 <code>take</code> 逻辑，也就是没法监听后续action，导致只会运行一次 <code>cb</code></p><h3 id="例子-实现takelatest" tabindex="-1"><a class="header-anchor" href="#例子-实现takelatest" aria-hidden="true">#</a> 例子：实现takeLatest</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">myTakeLatest</span><span class="token punctuation">(</span><span class="token parameter">actionType<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> task <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span>actionType<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">yield</span> <span class="token function">cancel</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      task <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>和takeEvery内部的逻辑类似，定义一个 <code>task</code> 变量用来存放任务，每次匹配action都会判断，如果任务存在则取消任务，之后又通过 <code>fork</code> 创建一个新任务并赋值 <code>task</code></p><h3 id="例子-流程管理" tabindex="-1"><a class="header-anchor" href="#例子-流程管理" aria-hidden="true">#</a> 例子：流程管理</h3><p>例如我们需要监听登录和注销两个action，如果已登录则只能注销，如果已注销则只能登录</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">accountFork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> loginAction <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">&quot;LOGIN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;用户已登录，进行初始化&quot;</span><span class="token punctuation">,</span> loginAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> logoutAction <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">&quot;LOGOUT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;用户已注销，删除登录状态&quot;</span><span class="token punctuation">,</span> logoutAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span>accountFork<span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;rootSaga执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;LOGOUT&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;LOGIN&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;LOGIN&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;LOGOUT&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;LOGOUT&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// rootSaga执行</span>
<span class="token comment">// 用户已登录，进行初始化 { type: &#39;LOGIN&#39;, payload: 1 }</span>
<span class="token comment">// 用户已注销，删除登录状态 { type: &#39;LOGOUT&#39;, payload: 3 }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>只需要在一个任务中监听两个action即可，当监听到 <code>LOGIN</code> 的action提交后，代码会阻塞在 <code>yield take(&quot;LOGOUT&quot;)</code> 处，之后的 <code>LOGIN</code> action都无法匹配 <code>LOGOUT</code>，当提交 <code>LOGOUT</code> action的时候，代码又回到 <code>yield take(&quot;LOGIN&quot;)</code> 地方阻塞，整个流程就像一个开关</p><h2 id="redux-actions" tabindex="-1"><a class="header-anchor" href="#redux-actions" aria-hidden="true">#</a> redux-actions</h2><p>改库提供一些工具函数来简化action和reducer代码</p><p>如果项目比较复杂，redux大致是以下结构</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// actions.js</span>
<span class="token keyword">const</span> <span class="token constant">ACTION_TYPES</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">ADD_NUM</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&quot;ADD_NUM&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token constant">SUB_NUM</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&quot;SUB_NUM&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token constant">SET_NUM</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&quot;SET_NUM&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token constant">CLEAR_NUM</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&quot;CLEAR_NUM&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getAddNumAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">ACTION_TYPES</span><span class="token punctuation">.</span><span class="token constant">ADD_NUM</span><span class="token punctuation">,</span>
    <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getSubNumAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">ACTION_TYPES</span><span class="token punctuation">.</span><span class="token constant">SUB_NUM</span><span class="token punctuation">,</span>
    <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getSetNumAction</span><span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">ACTION_TYPES</span><span class="token punctuation">.</span><span class="token constant">SET_NUM</span><span class="token punctuation">,</span>
    payload<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getClearNumAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">ACTION_TYPES</span><span class="token punctuation">.</span><span class="token constant">CLEAR_NUM</span><span class="token punctuation">,</span>
    <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// reduser.js</span>
<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token constant">ACTION_TYPES</span><span class="token punctuation">.</span><span class="token constant">ADD_NUM</span><span class="token operator">:</span>
    <span class="token keyword">case</span> <span class="token constant">ACTION_TYPES</span><span class="token punctuation">.</span><span class="token constant">SUB_NUM</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token constant">ACTION_TYPES</span><span class="token punctuation">.</span><span class="token constant">SET_NUM</span><span class="token operator">:</span>
    <span class="token keyword">case</span> <span class="token constant">ACTION_TYPES</span><span class="token punctuation">.</span><span class="token constant">CLEAR_NUM</span><span class="token operator">:</span>
      <span class="token keyword">return</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// store.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;redux&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 在某文件下使用</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">getAddNumAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="createaction-s" tabindex="-1"><a class="header-anchor" href="#createaction-s" aria-hidden="true">#</a> createAction(s)</h3><p>action部分可以使用createAction(s)函数来简化操作</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> getAddNumAction <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">&quot;ADD_NUM&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment">// ↑ 等价于 ↓</span>

<span class="token keyword">function</span> <span class="token function">getAddNumAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;ADD_NUM&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> getSetNumAction <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">&quot;SET_NUM&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> payload<span class="token punctuation">)</span>

<span class="token comment">// ↑ 等价于 ↓</span>

<span class="token keyword">function</span> <span class="token function">getSetNumAction</span><span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;SET_NUM&quot;</span><span class="token punctuation">,</span>
    payload<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>createAction函数第一个参数传action的类型，只能只字符串。第二个参数传一个函数，函数的返回值就是payload。第三个参数传一个函数，函数的返回值是meta</p><p>当然这个方法还不够简化，我们可以利用createActions生成多个action</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>addNum<span class="token punctuation">,</span> subNum<span class="token punctuation">,</span> setNum<span class="token punctuation">,</span> clearNum<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createActions</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">ADD_NUM</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token function-variable function">SUB_NUM</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token function-variable function">SET_NUM</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">,</span>
  <span class="token function-variable function">CLEAR_NUM</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ↑ 等价于 ↓</span>

<span class="token keyword">function</span> <span class="token function">addNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;ADD_NUM&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">subNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;SUB_NUM&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">setNum</span><span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;SET_NUM&quot;</span><span class="token punctuation">,</span>
    payload<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">clearNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;CLEAR_NUM&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="handleaction-s" tabindex="-1"><a class="header-anchor" href="#handleaction-s" aria-hidden="true">#</a> handleAction(s)</h3><p>该方法可以简化reducer</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token function">handleAction</span><span class="token punctuation">(</span><span class="token string">&quot;ADD_NUM&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state <span class="token operator">+</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">// ↑ 等价于 ↓</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;ADD_NUM&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>handleAction第一个参数是字符串，当然也可以是createAction(s)返回的获取action函数。第二个参数是当前action处理函数。第三个参数是默认值</p><p>不过针对某个action生成reducer比较少见，不过handleActions可以处理多个action</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token function">handleActions</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    <span class="token constant">ADD_NUM</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token constant">SUB_NUM</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token constant">SET_NUM</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token constant">CLEAR_NUM</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">0</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ↑ 等价于 ↓</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;ADD_NUM&quot;</span><span class="token operator">:</span>
    <span class="token keyword">case</span> <span class="token string">&quot;SUB_NUM&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;SET_NUM&quot;</span><span class="token operator">:</span>
    <span class="token keyword">case</span> <span class="token string">&quot;CLEAR_NUM&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>handleActions接收两个参数，第一个参数是针对各种action处理函数的map，map的键是可以为createAction(s)返回的获取action函数。第二个参数是仓库默认状态</p><h3 id="combineactions" tabindex="-1"><a class="header-anchor" href="#combineactions" aria-hidden="true">#</a> combineActions</h3><p>我们沿用handleAction(s)的例子，如果有多个action需要共享同一个处理函数，那么就可以用到该工具函数</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// reduser.js</span>
<span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token function">handleActions</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token function">combineActions</span><span class="token punctuation">(</span>addNum<span class="token punctuation">,</span> subNum<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token function">combineActions</span><span class="token punctuation">(</span>setNum<span class="token punctuation">,</span> clearNum<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token number">0</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">上次编辑于: </span><!----></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: marx10086@gmail.com">marx</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/note/redux/3.%E5%AE%9E%E7%8E%B0%E7%AE%80%E6%98%93Redux.html" class="nav-link prev" aria-label="实现简易Redux"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->实现简易Redux</div></a><!----></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/note/assets/app.002a81c8.js" defer></script>
  </body>
</html>
